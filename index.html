<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OX 퀴즈 - 공통수학2 (Firebase)</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#f97316">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="OX퀴즈">
  <link rel="apple-touch-icon" href="/icon-192.png">
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { 
      font-family: 'Noto Sans KR', sans-serif;
    }
    .icon { width: 24px; height: 24px; stroke: currentColor; fill: none; stroke-width: 2; }
    
    @media (hover: none) and (pointer: coarse) {
      * {
        -webkit-tap-highlight-color: transparent;
        transition: none !important;
      }
      *:active, *:focus, *:hover {
        outline: none !important;
        border-color: inherit !important;
        box-shadow: inherit !important;
        transform: none !important;
      }
    }
  </style>
</head>
<body class="bg-black">
  <div id="app"></div>

  <script>
    // Firebase 설정
    const firebaseConfig = {
      apiKey: "AIzaSyCtS_FVlL18WC_ikOWw0Hgl8MSjdH-jSGc",
      authDomain: "ox-quiz-math.firebaseapp.com",
      projectId: "ox-quiz-math",
      storageBucket: "ox-quiz-math.firebasestorage.app",
      messagingSenderId: "1065273366803",
      appId: "1:1065273366803:web:49d4f836f185af67d1e2e6"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();

    let offlineDB;

    // 관리자 보안 키 (실제 사용시 환경변수나 안전한 곳에 보관)
    const ADMIN_SECRET_KEY = "MATH2025ADMIN";
    const ADMIN_PASSWORD = "teacher2025"; // 관리자 공통 비밀번호

    // 아이콘 SVG
    const icons = {
      user: '<path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2M16 7a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z"/>',
      bookOpen: '<path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2zM22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>',
      chevronLeft: '<path d="m15 18-6-6 6-6"/>',
      chevronRight: '<path d="m9 18 6-6-6-6"/>',
      home: '<path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2zM9 22V12h6v10"/>',
      barChart: '<path d="M3 3v18h18M18 17V9M13 17V5M8 17v-3"/>',
      award: '<path d="M8.21 13.89 7 23l5-3 5 3-1.21-9.12M15 8A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>',
      lock: '<path d="M7 11V7a5 5 0 0 1 10 0v4M5 11h14a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2Z"/>',
      checkCircle: '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14M22 4 12 14.01l-3-3"/>',
      xCircle: '<circle cx="12" cy="12" r="10"/><path d="M15 9l-6 6M9 9l6 6"/>',
      clock: '<path d="M12 6v6l4 2M22 12A10 10 0 1 1 2 12a10 10 0 0 1 20 0Z"/>',
      users: '<path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75M13 7a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z"/>',
      settings: '<circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m6.36 6.36 4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m6.36-6.36 4.24-4.24"/>'
    };

    function icon(type, className = '', size = 24) {
      return `<svg class="${className}" style="width:${size}px;height:${size}px;flex-shrink:0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">${icons[type]}</svg>`;
    }

    // IndexedDB 초기화
    function initIndexedDB() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open('OXQuizDB', 1);
        
        request.onerror = () => reject(request.error);
        request.onsuccess = () => {
          offlineDB = request.result;
          resolve(offlineDB);
        };
        
        request.onupgradeneeded = (event) => {
          const db = event.target.result;
          if (!db.objectStoreNames.contains('pendingData')) {
            db.createObjectStore('pendingData', { keyPath: 'id', autoIncrement: true });
          }
        };
      });
    }

    async function saveToIndexedDB(data) {
      return new Promise((resolve, reject) => {
        const transaction = offlineDB.transaction(['pendingData'], 'readwrite');
        const store = transaction.objectStore('pendingData');
        const request = store.add({
          uid: state.uid,
          data: data,
          timestamp: Date.now()
        });
        
        request.onsuccess = () => resolve();
        request.onerror = () => reject(request.error);
      });
    }

    async function deleteFromIndexedDB(id) {
      return new Promise((resolve, reject) => {
        const transaction = offlineDB.transaction(['pendingData'], 'readwrite');
        const store = transaction.objectStore('pendingData');
        const request = store.delete(id);
        
        request.onsuccess = () => resolve();
        request.onerror = () => reject(request.error);
      });
    }

    async function syncPendingData() {
      try {
        const transaction = offlineDB.transaction(['pendingData'], 'readonly');
        const store = transaction.objectStore('pendingData');
        const request = store.getAll();
        
        request.onsuccess = async () => {
          const pendingItems = request.result;
          
          for (const item of pendingItems) {
            try {
              await db.collection('students').doc(item.uid).set(item.data);
              await deleteFromIndexedDB(item.id);
              console.log('동기화 완료:', item.id);
            } catch (error) {
              console.error('동기화 실패:', error);
            }
          }
          
          if (pendingItems.length > 0) {
            alert(`${pendingItems.length}개의 데이터가 동기화되었습니다!`);
            await loadData(state.uid);
            render();
          }
        };
      } catch (error) {
        console.error('동기화 오류:', error);
      }
    }

    // 카테고리 데이터
    const categories = [
      { id: 1, name: "Chapter 1. 평면좌표", chapters: [] },
      { id: 2, name: "Chapter 2. 직선의 방정식", chapters: [] },
      { id: 3, name: "Chapter 3. 원의 방정식", chapters: [] },
      { id: 4, name: "Chapter 4. 도형의 이동", chapters: [] },
      { id: 5, name: "Chapter 5. 집합", chapters: [] },
      { 
        id: 6, 
        name: "Chapter 6. 명제",
        chapterInfo: [
          { partName: "Part1", description: "명제와 조건", range: "Thema 1~3" },
          { partName: "Part2", description: "명제의 역과 대우", range: "Thema 4~5" },
          { partName: "Part3", description: "필요조건과 충분조건", range: "Thema 6" },
          { partName: "Part4", description: "절대부등식", range: "Thema 7~9" }
        ],
        chapters: [
          { id: 1, name: "Thema 1. 명제와 조건", questions: [
            { question: "문장 '송강은 잘생겼다'는 모든 사람이 동의하므로 명제라고 할 수 있다.", answer: "X", hint: "명제는 객관적으로 참 또는 거짓을 판단할 수 있어야 합니다.", explanation: "주관적 판단은 명제가 아닙니다." },
            { question: "문장 '민호 쌤은 남자다'는 참, 거짓을 객관적으로 판단할 수 있으므로 명제이다.", answer: "O", hint: "객관적 판단이 가능한지 생각해보세요.", explanation: "객관적으로 참/거짓 판단이 가능하면 명제입니다." },
            { question: "문장 'x−3=0'은 x의 값에 따라 참, 거짓이 달라지므로 명제라고 할 수 있다.", answer: "X", hint: "x의 값에 따라 참/거짓이 달라지는 것은 무엇일까요?", explanation: "x의 값에 따라 참/거짓이 달라지는 것은 '조건'이지 명제가 아닙니다." },
            { question: "'x는 짝수이다.'는 명제다.", answer: "X", hint: "변수 x의 값에 따라 달라지나요?", explanation: "x의 값에 따라 참/거짓이 달라지므로 '조건'입니다." },
            { question: "조건 p의 진리집합 P는 조건을 참으로 만드는 모든 원소의 집합을 의미한다.", answer: "O", hint: "진리집합의 정의를 떠올려보세요.", explanation: "진리집합은 조건을 참으로 만드는 원소들의 집합입니다." },
            { question: "같은 조건이라도 진리집합이 여러 개일 수 있다.", answer: "X", hint: "하나의 조건에 대한 진리집합은 몇 개일까요?", explanation: "같은 조건의 진리집합은 유일하게 하나만 존재합니다." },
            { question: "명제 'x는 6의 약수이면 x는 3의 약수이다'는 참이다.", answer: "X", hint: "6의 약수 중 3의 약수가 아닌 것이 있나요?", explanation: "6의 약수 중 2는 3의 약수가 아니므로 거짓입니다." }
          ]},
          { id: 2, name: "Thema 2. 부정(not)", questions: [
            { question: "조건 p의 부정은 기호로 '~p'와 같이 나타내며, 'not p' 또는 'p가 아니다'라고 읽는다.", answer: "O", hint: "부정의 기호 표현을 생각해보세요.", explanation: "~p는 'not p'로 읽으며, p의 부정을 의미합니다." },
            { question: "조건 p의 진리집합이 P일 때, 부정 ~p의 진리집합은 P의 여집합인 Pᶜ이다.", answer: "O", hint: "부정의 진리집합과 원래 진리집합의 관계는?", explanation: "부정의 진리집합은 원래 진리집합의 여집합입니다." },
            { question: "x>0의 부정은 x<0이다.", answer: "X", hint: "x=0인 경우도 생각해보세요.", explanation: "x>0의 부정은 x≤0입니다. x=0인 경우도 포함됩니다." },
            { question: "∼(∼p)=p 이다.", answer: "O", hint: "부정의 부정을 생각해보세요.", explanation: "부정의 부정은 원래 조건과 같습니다." },
            { question: "'p 또는 q'의 부정은 '~p 또는 ~q'이다.", answer: "X", hint: "드모르간 법칙을 떠올려보세요.", explanation: "'p 또는 q'의 부정은 '~p 그리고 ~q'입니다. (드모르간 법칙)" },
            { question: "유리수의 부정은 무리수이다(실수 범위 전제).", answer: "O", hint: "실수는 유리수와 무리수로 나뉩니다.", explanation: "실수 범위에서 유리수가 아닌 수는 무리수입니다." }
          ]},
          { id: 3, name: "Thema 3. 조건으로 명제 만들기", questions: [
            { question: "p, q가 조건일 때 'p이면 q이다(p→q)'는 명제다.", answer: "O", hint: "조건으로 만든 문장의 특성을 생각해보세요.", explanation: "조건으로 만든 'p→q' 형태는 명제입니다." },
            { question: "p→q의 참·거짓은 진리집합 P⊂Q 여부로 판별한다.", answer: "O", hint: "진리집합의 포함관계를 생각해보세요.", explanation: "P가 Q의 부분집합이면 p→q는 참입니다." },
            { question: "P⊄Q이면 p→q는 거짓이다.", answer: "O", hint: "부분집합이 아닐 때를 생각해보세요.", explanation: "P가 Q의 부분집합이 아니면 p→q는 거짓입니다." },
            { question: "'모든'은 한 개만 틀려도 거짓, '어떤'은 한 개만 맞아도 참이다.", answer: "O", hint: "전칭명제와 존재명제의 특성을 생각해보세요.", explanation: "전칭명제('모든')는 하나만 반례가 있어도 거짓, 존재명제('어떤')는 하나만 참이면 참입니다." },
            { question: "'적어도 하나는 ~이다'의 부정은 '모두 ~가 아니다'이다.", answer: "O", hint: "존재명제의 부정을 생각해보세요.", explanation: "존재명제의 부정은 전칭명제가 됩니다." },
            { question: "모든 실수 x에 대하여 x²≥0은 참이다.", answer: "O", hint: "제곱의 성질을 생각해보세요.", explanation: "제곱은 항상 0 이상입니다." }
          ]},
          { id: 4, name: "Thema 4. 역과 대우", questions: [
            { question: "원래 명제가 참이면, 그 명제의 역은 항상 참이다.", answer: "X", hint: "명제와 역의 참·거짓은 독립적인가요?", explanation: "원래 명제가 참이어도 역은 거짓일 수 있습니다. 예: '6의 약수→3의 약수'는 거짓이지만 원명제는 참일 수 있습니다." },
            { question: "원래 명제가 거짓이면, 그 명제의 대우는 항상 거짓이다.", answer: "O", hint: "명제와 대우의 참·거짓 관계를 생각해보세요.", explanation: "명제와 대우는 항상 같은 참·거짓 값을 가집니다." },
            { question: "p→q의 역은 q→p이다.", answer: "O", hint: "역의 정의를 떠올려보세요.", explanation: "역은 가정과 결론을 서로 바꾼 것입니다." },
            { question: "p→q가 참이면 역도 항상 참이다.", answer: "X", hint: "예: '사람이면 동물이다'가 참이면, '동물이면 사람이다'도 참일까요?", explanation: "명제가 참이어도 역은 거짓일 수 있습니다. 예: '사람→동물'은 참이지만, 역 '동물→사람'은 거짓입니다. 명제와 역은 독립적입니다." },
            { question: "p→q의 대우는 ~q→~p이다.", answer: "O", hint: "대우의 정의를 생각해보세요.", explanation: "대우는 가정과 결론을 각각 부정하고 순서를 바꾼 것입니다." },
            { question: "대우 명제는 원래 명제의 참거짓을 판별하기 어려울 때 사용될 수 있다.", answer: "O", hint: "대우를 이용한 증명을 생각해보세요.", explanation: "원명제를 직접 증명하기 어려울 때 대우를 증명하여 원명제의 참을 보일 수 있습니다." },
            { question: "삼단논법에 따라 'p이면 q이다'와 'q이면 r이다'가 모두 참이면, 'r이면 p이다'도 항상 참이다.", answer: "X", hint: "삼단논법의 결론을 정확히 생각해보세요.", explanation: "삼단논법에서는 'p→r'이 참이 됩니다. 'r→p'는 역이므로 항상 참은 아닙니다." }
          ]},
          { id: 5, name: "Thema 5. 귀류법", questions: [
            { question: "귀류법은 명제(또는 결론)를 부정하고 모순을 만들어 참을 보이는 방법이다.", answer: "O", hint: "귀류법의 증명 방식을 생각해보세요.", explanation: "귀류법은 결론을 부정했을 때 모순이 발생함을 보여 원래 명제가 참임을 증명하는 방법입니다." },
            { question: "명제 'ab가 홀수면 a,b 모두 홀수'도 귀류법으로 증명할 수 있다.", answer: "O", hint: "결론을 부정하면 어떻게 될까요?", explanation: "결론 'a,b 모두 홀수'를 부정하면 적어도 하나는 짝수인데, 그러면 ab가 짝수가 되어 모순입니다." },
            { question: "대우증명과 귀류법은 같은 방법이다.", answer: "X", hint: "두 방법의 차이를 생각해보세요.", explanation: "대우증명은 ~q→~p를 증명하는 것이고, 귀류법은 결론을 부정했을 때 모순을 도출하는 방법입니다." }
          ]},
          { id: 6, name: "Thema 6. 필요조건과 충분조건", questions: [
            { question: "p→q가 참이면 p는 q의 충분조건이다.", answer: "O", hint: "'주충받필'을 떠올려보세요.", explanation: "p→q가 참이면 p는 q이기 위한 충분조건입니다. (주면 충분)" },
            { question: "P⊂Q이면 p는 q의 필요조건이다.", answer: "X", hint: "P⊂Q는 p→q를 의미합니다.", explanation: "P⊂Q이면 p→q가 참이므로 p는 q의 충분조건입니다." },
            { question: "'주충받필'은 '주면 충분, 받으면 필요'를 뜻한다.", answer: "O", hint: "화살표 방향을 생각해보세요.", explanation: "p→q에서 p는 '주는' 쪽으로 충분조건, q는 '받는' 쪽으로 필요조건입니다." },
            { question: "필요충분조건이면 원명제와 역이 모두 참이다.", answer: "O", hint: "필요충분조건의 의미를 생각해보세요.", explanation: "필요충분조건은 p→q와 q→p가 모두 참인 경우입니다." },
            { question: "두 실수 a, b에 대하여 a²+b²=0이면, a=0이고 b=0이다.", answer: "O", hint: "제곱수의 성질을 생각해보세요.", explanation: "실수의 제곱은 항상 0 이상이므로, 두 제곱수의 합이 0이면 각각 0이어야 합니다." },
            { question: "두 조건 p, q의 진리집합을 각각 P, Q라 할 때, P=Q이면 p는 q이기 위한 필요충분조건이다.", answer: "O", hint: "진리집합이 같다는 것의 의미를 생각해보세요.", explanation: "P=Q이면 P⊂Q이고 Q⊂P이므로 p↔q가 성립하여 필요충분조건입니다." },
            { question: "조건 'x²=1'은 조건 'x=1'이기 위한 충분조건이다.", answer: "X", hint: "x²=1을 만족하는 모든 x값을 생각해보세요.", explanation: "x²=1이면 x=1 또는 x=-1이므로 'x²=1'은 'x=1'의 필요조건입니다. (충분조건이 아님)" }
          ]},
          { id: 7, name: "Thema 7. 절대부등식", questions: [
            { question: "x²+1≥0은 모든 실수 x에서 참이다.", answer: "O", hint: "제곱수는 항상 0 이상입니다.", explanation: "x²는 항상 0 이상이므로 x²+1≥1>0입니다." },
            { question: "x²−1≥0은 절대부등식이다.", answer: "X", hint: "모든 x에서 성립하나요?", explanation: "x=0일 때 -1≥0이 되어 거짓이므로 전 구간에서 성립하지 않습니다." },
            { question: "a²+b²>0은 모든 실수 a,b에서 항상 참이다.", answer: "X", hint: "a=b=0인 경우를 생각해보세요.", explanation: "a=b=0이면 a²+b²=0이므로 >0이 성립하지 않습니다." },
            { question: "|ab|=|a||b| 이다.", answer: "O", hint: "절댓값의 곱셈 성질을 떠올려보세요.", explanation: "절댓값의 곱은 각 절댓값의 곱과 같습니다." },
            { question: "|a|+|b| > |a+b| 이다.", answer: "X", hint: "등호가 성립하는 경우가 있나요?", explanation: "삼각부등식에 의해 |a|+|b| ≥ |a+b|이며, 등호는 ab≥0일 때 성립합니다." },
            { question: "a>0, b>0이면 a>b ⇔ a²>b² 이다.", answer: "O", hint: "양수끼리는 제곱해도 대소관계가 유지됩니다.", explanation: "양수 범위에서는 제곱 함수가 증가함수이므로 대소관계가 유지됩니다." },
            { question: "a>0, b>0이면 a/b>1 ⇔ a<b 이다.", answer: "X", hint: "a/b>1은 a가 b보다 큰가요, 작은가요?", explanation: "a/b>1이면 a>b입니다. 따라서 a/b>1 ⇔ a>b가 맞습니다." }
          ]},
          { id: 8, name: "Thema 8. 절대부등식의 증명법", questions: [
            { question: "절대부등식을 증명할 때, 두 식의 차를 이용하는 방법이나 제곱의 차를 이용하는 방법이 사용될 수 있다.", answer: "O", hint: "차를 이용한 증명법의 종류를 생각해보세요.", explanation: "A≥B를 증명하려면 A-B≥0 또는 A²-B²≥0 (단, A,B≥0)을 보이면 됩니다." },
            { question: "근호·절댓값이 있으면 제곱의 차로 비교하면 편하다.", answer: "O", hint: "제곱하면 근호와 절댓값이 어떻게 되나요?", explanation: "제곱하면 근호와 절댓값이 제거되어 계산이 간단해집니다." },
            { question: "|a|+|b| ≥ |a+b| 는 제곱 비교로도 증명할 수 있다.", answer: "O", hint: "양변을 제곱해서 비교할 수 있나요?", explanation: "양변이 모두 음이 아니므로 제곱하여 비교할 수 있습니다." },
            { question: "비( A/B )를 쓰려면 A,B가 둘 다 양수여야 한다.", answer: "O", hint: "분모가 0이거나 음수이면 어떻게 되나요?", explanation: "비를 정의하려면 분모가 양수여야 하며, 대소 비교를 위해 분자도 양수여야 합니다." },
            { question: "A>0, B>0에서 (A/B)>1 ⇔ A<B 이다.", answer: "X", hint: "A/B>1을 정리해보세요.", explanation: "A/B>1이면 A>B입니다. 따라서 (A/B)>1 ⇔ A>B가 맞습니다." },
            { question: "제곱해서 비교할 때는 부호 조건을 확인하지 않아도 된다.", answer: "X", hint: "음수를 제곱하면 어떻게 되나요?", explanation: "제곱 비교는 양변이 모두 음이 아닐 때만 가능합니다. 부호 조건을 반드시 확인해야 합니다." },
            { question: "인수분해나 완전제곱식으로 바꾸면 부호 판정이 쉬워진다.", answer: "O", hint: "완전제곱식의 부호는 어떤가요?", explanation: "완전제곱식은 항상 0 이상이므로 부호 판정이 명확해집니다." }
          ]},
          { id: 9, name: "Thema 9. 산술기하 평균", questions: [
            { question: "산술기하 평균 부등식 (a+b)/2 ≥ √(ab) 는 모든 실수 a,b에 대하여 성립한다.", answer: "X", hint: "√(ab)가 정의되려면 어떤 조건이 필요한가요?", explanation: "산술기하 평균은 a,b가 모두 양수일 때 성립합니다. (또는 a,b≥0)" },
            { question: "산술기하 평균 부등식의 등호는 a=b에서 성립한다.", answer: "O", hint: "등호 조건을 생각해보세요.", explanation: "산술기하 평균에서 등호는 두 수가 같을 때, 즉 a=b일 때 성립합니다." },
            { question: "산술기하 평균은 '두 양수의 곱이 일정할 때, 합의 최솟값'을 구하는 데 사용된다.", answer: "O", hint: "(a+b)/2 ≥ √(ab)에서 ab가 상수일 때를 생각해보세요.", explanation: "ab=k(상수)일 때, a+b≥2√k이므로 합의 최솟값은 2√k입니다." },
            { question: "산술기하 평균은 '두 양수의 합이 일정할 때, 곱의 최댓값'을 구하는 데 사용된다.", answer: "O", hint: "(a+b)/2 ≥ √(ab)에서 a+b가 상수일 때를 생각해보세요.", explanation: "a+b=k(상수)일 때, √(ab)≤k/2이므로 ab≤k²/4이며, 곱의 최댓값은 k²/4입니다." },
            { question: "두 양수 x,y에 대하여 x+y=10일 때, xy의 최댓값은 산술기하 평균을 이용하여 구할 수 있다.", answer: "O", hint: "합이 일정할 때 곱의 최댓값 문제입니다.", explanation: "10=x+y≥2√(xy)이므로 √(xy)≤5, xy≤25입니다. 최댓값은 25 (x=y=5일 때)입니다." },
            { question: "문자 곱이 상수로 사라지면 산술기하 평균을 우선 떠올린다.", answer: "O", hint: "xy=k 형태가 나타나면?", explanation: "문자의 곱이 상수가 되면 산술기하 평균을 적용하여 합의 최솟값을 구할 수 있습니다." },
            { question: "산술기하 평균에서 최댓값·최솟값을 구할 때는 등호 조건을 반드시 확인해야 한다.", answer: "O", hint: "등호 조건이 왜 중요한가요?", explanation: "등호 조건(a=b)을 만족할 때 실제로 최댓값이나 최솟값이 존재하므로 반드시 확인해야 합니다." }
          ]}
        ]
      },
      {
        id: 7,
        name: "Chapter 7. 함수",
        chapterInfo: [],
        chapters: [
          {
            id: 1,
            name: "Thema 1. 함수의 정의",
            questions: [
              { question: "함수는 X의 모든 원소가 Y의 원소와 딱 하나씩 짝지어지는 규칙이다.", answer: "O", hint: "함수의 기본 정의를 생각해보세요.", explanation: "함수는 정의역의 각 원소가 공역의 원소와 정확히 하나씩 대응되는 관계입니다." },
              { question: "어떤 x는 아예 짝을 못 가져도 함수가 될 수 있다.", answer: "X", hint: "정의역의 모든 원소는 어떻게 되어야 하나요?", explanation: "함수는 정의역의 '모든' 원소가 공역의 원소와 대응되어야 합니다. 짝이 없는 x가 있으면 함수가 아닙니다." },
              { question: "서로 다른 x들이 같은 y로 갈 수는 있다.", answer: "O", hint: "다대일 대응을 생각해보세요.", explanation: "함수에서는 여러 개의 x가 같은 y값을 가질 수 있습니다. 하지만 하나의 x가 여러 y를 가질 수는 없습니다." },
              { question: "f: X→Y 에서 X는 정의역, Y는 공역이다.", answer: "O", hint: "함수 표기법의 의미를 생각해보세요.", explanation: "f: X→Y에서 X는 정의역(입력값의 집합), Y는 공역(출력값이 속하는 집합)입니다." },
              { question: "치역은 실제로 나온 y들의 모음이다.", answer: "O", hint: "공역과 치역의 차이를 생각해보세요.", explanation: "치역은 실제로 함수값으로 나오는 y들의 집합입니다. 공역의 부분집합입니다." },
              { question: "치역과 공역은 항상 같다.", answer: "X", hint: "공역 중 사용되지 않는 원소가 있을 수 있나요?", explanation: "치역은 공역의 부분집합이지만 항상 같지는 않습니다. 공역에 속하지만 어떤 x로도 만들어지지 않는 y가 있을 수 있습니다." },
              { question: "함수에서 y=f(x)의 값을 '함숫값'이라고 부른다.", answer: "O", hint: "함수에 x를 대입하면 무엇이 나오나요?", explanation: "x에 대응되는 값 f(x)를 함숫값이라고 합니다." },
              { question: "정의역이 주어지면, 그 안의 모든 x에 대해 f(x)가 정해져야 한다.", answer: "O", hint: "함수의 정의를 다시 생각해보세요.", explanation: "함수는 정의역의 모든 원소에 대해 함숫값이 정의되어야 합니다." },
              { question: "정의역/공역이 따로 없으면, 보통 '식이 되는 모든 실수 → 실수'로 본다.", answer: "O", hint: "함수의 자연정의역을 생각해보세요.", explanation: "특별한 언급이 없으면, 함수의 정의역은 식이 정의되는 모든 실수, 공역은 실수 전체로 봅니다." },
              { question: "x 하나를 넣었더니 경우에 따라 f(x)가 두 값이 나오면 그건 함수다.", answer: "X", hint: "하나의 x에 대응되는 y는 몇 개여야 하나요?", explanation: "함수는 하나의 x에 대해 정확히 하나의 y값만 대응되어야 합니다. 두 개 이상의 값이 나오면 함수가 아닙니다." }
            ]
          },
          {
            id: 2,
            name: "Thema 2. 두 함수가 같다",
            questions: [
              { question: "두 함수가 같으려면 정의역과 공역이 각각 같아야 한다.", answer: "O", hint: "함수가 같다는 것은 무엇을 의미하나요?", explanation: "두 함수가 같으려면 정의역, 공역, 대응 규칙이 모두 같아야 합니다." },
              { question: "두 함수가 같으려면 모든 x에 대해 f(x)=g(x)여야 한다.", answer: "O", hint: "대응 규칙이 같다는 것의 의미를 생각해보세요.", explanation: "정의역의 모든 원소 x에 대해 f(x)=g(x)가 성립해야 같은 함수입니다." },
              { question: "식만 같으면 정의역이 달라도 같은 함수다.", answer: "X", hint: "정의역의 중요성을 생각해보세요.", explanation: "식이 같아도 정의역이 다르면 다른 함수입니다. 정의역은 함수를 결정하는 중요한 요소입니다." },
              { question: "그래프가 같으면 정의역·공역이 달라도 같은 함수다.", answer: "X", hint: "함수의 세 가지 구성 요소를 생각해보세요.", explanation: "그래프가 같아도 정의역이나 공역이 다르면 다른 함수입니다. 예를 들어 f: ℝ→ℝ와 g: [0,∞)→ℝ는 다른 함수입니다." },
              { question: "f(x)=x−1, g(x)=x²−1은 정의역에 따라 같은 함수가 될 수도 있다.", answer: "O", hint: "어떤 정의역에서 두 식이 같아질까요?", explanation: "정의역이 {1}일 때, f(1)=0, g(1)=0으로 같은 함숫값을 가지므로 같은 함수가 될 수 있습니다." },
              { question: "식이 다르면 두 함수는 절대 같을 수 없다.", answer: "X", hint: "다른 식도 같은 값을 낼 수 있나요?", explanation: "식이 달라도 정의역의 모든 원소에서 함숫값이 같으면 같은 함수입니다. 예: 정의역이 {1, 2}이고 공역이 ℝ일 때, f(x)=2x와 g(x)=x²+x는 f(1)=2, g(1)=2이고 f(2)=4, g(2)=4로 모두 같으므로 같은 함수입니다." },
              { question: "식이 같아도 정의역·공역이 다르면 다른 함수가 될 수 있다.", answer: "O", hint: "함수를 결정하는 세 가지 요소를 생각해보세요.", explanation: "함수는 정의역, 공역, 대응 규칙으로 결정되므로, 식이 같아도 정의역이나 공역이 다르면 다른 함수입니다." },
              { question: "두 함수가 같은지 확인할 때는 정의역의 모든 원소를 대입해 함숫값을 비교한다.", answer: "O", hint: "어떤 x에 대해 확인해야 하나요?", explanation: "두 함수가 같은지 확인하려면 정의역의 모든 원소에 대해 함숫값이 같은지 확인해야 합니다." },
              { question: "몇 개 점만 맞으면 같은 함수라고 할 수 있다.", answer: "X", hint: "'모든' x에 대해 확인해야 하나요?", explanation: "일부 점에서만 함숫값이 같다고 해서 같은 함수가 아닙니다. 정의역의 모든 원소에서 같아야 합니다." },
              { question: "한 점에서만 f(x)=g(x)여도 같은 함수다.", answer: "X", hint: "몇 개의 점에서 같아야 하나요?", explanation: "한 점이 아니라 정의역의 모든 점에서 f(x)=g(x)여야 같은 함수입니다." },
              { question: "두 함수가 같으면 치역도 같다.", answer: "O", hint: "같은 함수라면 출력값들도 같을까요?", explanation: "정의역과 대응 규칙이 같으면 실제로 나오는 함숫값들의 집합인 치역도 같습니다." }
            ]
          },
          {
            id: 3,
            name: "Thema 3. 함수의 그래프",
            questions: [
              { question: "정의역·공역이 실수일 때, 그래프는 좌표평면에 점으로 나타낸다.", answer: "O", hint: "함수 그래프는 어떻게 그리나요?", explanation: "함수 y=f(x)의 그래프는 좌표평면 위의 점 (x, f(x))들의 집합으로 나타냅니다." },
              { question: "세로선 x=a가 어떤 a에서 두 점과 만나더라도, 그 그림은 함수 그래프이다.", answer: "X", hint: "세로선 테스트를 생각해보세요.", explanation: "함수 그래프는 모든 세로선 x=a가 최대 한 점과만 만나야 합니다. 두 점과 만나면 하나의 x에 두 개의 y가 대응되므로 함수가 아닙니다." },
              { question: "세로선 x=a와의 교점이 0개면, 그 a는 정의역이 아니다.", answer: "O", hint: "교점이 없다는 것의 의미를 생각해보세요.", explanation: "세로선 x=a와 그래프의 교점이 없다는 것은 x=a에서 함숫값이 정의되지 않았다는 의미이므로, a는 정의역에 속하지 않습니다." },
              { question: "곡선이면 함수가 아니고, 직선만 함수다.", answer: "X", hint: "y=x²의 그래프를 생각해보세요.", explanation: "함수 그래프는 직선일 수도, 곡선일 수도 있습니다. 세로선 테스트를 통과하면 곡선도 함수 그래프입니다." },
              { question: "직선 x=2 자체는 y=f(x) 형태의 함수 그래프가 될 수 있다.", answer: "X", hint: "세로선 x=2는 모든 y값과 만나나요?", explanation: "세로선 x=2는 하나의 x값에 무수히 많은 y값이 대응되므로 y=f(x) 형태의 함수 그래프가 될 수 없습니다." },
              { question: "y=x²의 그림은 모든 세로선과 한 번씩 만나므로 함수 그래프다.", answer: "O", hint: "각 x값에 y값이 몇 개 대응되나요?", explanation: "y=x²는 각 x값에 대해 정확히 하나의 y값(x²)이 대응되므로 함수 그래프입니다." },
              { question: "x=a에서 교점이 두 개인데 y좌표가 같으면 괜찮다.", answer: "X", hint: "교점의 개수를 생각해보세요.", explanation: "y좌표가 같더라도 교점이 두 개라는 것 자체가 모순입니다. 같은 점이면 교점은 1개입니다. 교점은 반드시 한 개여야 합니다." },
              { question: "그래프가 일부 끊겨 있어도, 세로선이 한 점만 만나면 함수 그래프가 될 수 있다.", answer: "O", hint: "연속성이 필수 조건인가요?", explanation: "함수는 연속일 필요가 없습니다. 그래프가 끊겨 있어도 각 x에 대해 y가 하나씩만 대응되면 함수입니다." },
              { question: "함수 그래프는 대표점 몇 개(절편 등)를 찍고 이어서 그릴 수 있다.", answer: "O", hint: "그래프를 그리는 실용적인 방법을 생각해보세요.", explanation: "실제로 함수 그래프를 그릴 때는 주요 점들(절편, 꼭짓점 등)을 찍고 매끄럽게 이어서 그립니다." },
              { question: "세로선 테스트는 '한 x에 두 y 불가'라는 함수 정의를 그림으로 옮긴 것이다.", answer: "O", hint: "세로선 테스트의 의미를 생각해보세요.", explanation: "세로선 테스트는 '하나의 x에 대해 정확히 하나의 y만 대응'이라는 함수의 정의를 시각적으로 확인하는 방법입니다." },
              { question: "세로선 테스트를 통과하면 무조건 일대일 함수다.", answer: "X", hint: "일대일 함수는 어떤 테스트로 확인하나요?", explanation: "세로선 테스트는 함수인지만 확인합니다. 일대일 함수인지는 가로선(수평선) 테스트로 확인해야 합니다." }
            ]
          },
          {
            id: 4,
            name: "Thema 4. 일대일함수·일대일대응",
            questions: [
              { question: "일대일함수는 x₁≠x₂이면 f(x₁)≠f(x₂)이다.", answer: "O", hint: "일대일함수의 정의를 생각해보세요.", explanation: "일대일함수는 서로 다른 정의역 원소가 서로 다른 치역 원소로 대응되는 함수입니다." },
              { question: "서로 다른 x가 같은 y로 가도 일대일함수일 수 있다.", answer: "X", hint: "일대일함수의 조건을 다시 생각해보세요.", explanation: "일대일함수는 서로 다른 x가 반드시 서로 다른 y로 대응되어야 합니다. 같은 y로 가면 일대일함수가 아닙니다." },
              { question: "일대일대응이면 치역과 공역이 같다.", answer: "O", hint: "일대일대응의 조건을 생각해보세요.", explanation: "일대일대응은 일대일함수이면서 동시에 치역=공역인 함수입니다." },
              { question: "일대일함수이면 언제나 일대일대응이다.", answer: "X", hint: "치역과 공역의 관계를 생각해보세요.", explanation: "일대일함수라도 치역이 공역보다 작으면 일대일대응이 아닙니다. 일대일대응이 되려면 치역=공역이어야 합니다." },
              { question: "일대일대응이면 정의역 원소 수와 공역 원소 수가 같다.", answer: "O", hint: "일대일대응의 의미를 생각해보세요.", explanation: "일대일대응은 정의역의 각 원소가 공역의 서로 다른 원소와 빠짐없이 대응되므로, 두 집합의 원소 개수가 같습니다." },
              { question: "그래프가 모든 a에 대해 수평선 y=a와 항상 한 점에서 만나면 일대일대응이다.", answer: "O", hint: "수평선 테스트의 의미를 생각해보세요.", explanation: "모든 수평선과 정확히 한 점에서 만난다는 것은 일대일(각 y에 x가 하나)이면서 치역=공역(모든 y가 사용됨)임을 의미합니다." },
              { question: "그래프가 계속 증가하기만 하면 언제나 일대일대응이다.", answer: "X", hint: "치역과 공역의 관계를 확인해야 하나요?", explanation: "증가함수는 일대일함수이지만, 치역=공역인지 확인해야 일대일대응입니다. 예: f:[0,1]→[0,2], f(x)=x는 증가하지만 치역은 [0,1]로 공역 [0,2]보다 작아 일대일대응이 아닙니다." },
              { question: "일대일대응 여부는 세로선으로 확인한다.", answer: "X", hint: "어떤 선으로 확인해야 하나요?", explanation: "세로선 테스트는 함수 여부만 확인합니다. 일대일대응은 수평선(가로선) 테스트로 확인해야 합니다." },
              { question: "정의역 [0,2], 공역 [0,10]에서 f(x)=3x는 일대일함수지만 일대일대응은 아니다.", answer: "O", hint: "치역의 범위를 계산해보세요.", explanation: "f(x)=3x는 일대일함수입니다. 하지만 치역은 [0,6]으로 공역 [0,10]보다 작으므로 일대일대응이 아닙니다." },
              { question: "일대일대응이면 치역이 공역보다 작다.", answer: "X", hint: "일대일대응의 정의를 생각해보세요.", explanation: "일대일대응은 치역=공역이어야 합니다. 치역이 공역보다 작으면 일대일대응이 아닙니다." },
              { question: "일대일함수는 반드시 증가함수이거나 감소함수여야 한다.", answer: "X", hint: "증가와 감소가 번갈아 나타날 수 있나요?", explanation: "일대일함수라도 증가와 감소가 반복될 수 있습니다. 예: 정의역 {1,2,3}에서 f(1)=2, f(2)=1, f(3)=3은 일대일함수이지만 단조함수는 아닙니다." }
            ]
          },
          {
            id: 5,
            name: "Thema 5. 항등함수·상수함수",
            questions: [
              { question: "항등함수는 정의역과 공역이 같고, 모든 x에 대해 f(x)=x이다.", answer: "O", hint: "항등함수의 정의를 생각해보세요.", explanation: "항등함수는 f: X→X이고 모든 x∈X에 대해 f(x)=x인 함수입니다." },
              { question: "항등함수는 일대일함수이면서 치역=공역이어서 일대일대응이다.", answer: "O", hint: "항등함수의 성질을 생각해보세요.", explanation: "f(x)=x는 서로 다른 x가 서로 다른 값으로 가므로 일대일함수이고, 모든 x∈X가 자기 자신으로 대응되므로 치역=공역=X입니다. 따라서 일대일대응입니다." },
              { question: "상수함수는 모든 x에 대해 값이 같은 함수, 즉 f(x)=c 형태다.", answer: "O", hint: "상수함수의 정의를 생각해보세요.", explanation: "상수함수는 정의역의 모든 원소가 하나의 같은 값 c로 대응되는 함수입니다." },
              { question: "상수함수의 치역은 여러 값으로 이루어진다.", answer: "X", hint: "모든 x가 같은 값으로 가면 치역은?", explanation: "상수함수 f(x)=c의 치역은 {c} 하나의 원소로만 이루어진 집합입니다." },
              { question: "항등함수도 상수함수의 한 종류다.", answer: "X", hint: "f(x)=x에서 함숫값이 변하나요?", explanation: "항등함수 f(x)=x는 x값에 따라 함숫값이 변하므로 상수함수가 아닙니다. 상수함수는 모든 x에 대해 같은 값을 가져야 합니다." },
              { question: "상수함수는 정의역의 일부에서만 같은 값을 가지면 된다.", answer: "X", hint: "'모든' x에서 같아야 하나요?", explanation: "상수함수는 정의역의 '모든' 원소에 대해 같은 값을 가져야 합니다. 일부에서만 같으면 상수함수가 아닙니다." },
              { question: "항등함수 f: X→X의 치역은 X 전체다.", answer: "O", hint: "f(x)=x일 때 어떤 값들이 나오나요?", explanation: "항등함수는 모든 x∈X에 대해 f(x)=x이므로, X의 모든 원소가 함숫값으로 나옵니다. 따라서 치역=X입니다." },
              { question: "정의역과 공역이 다르더라도 f(x)=x이면 항등함수라 부른다.", answer: "X", hint: "항등함수의 정의에서 정의역과 공역의 관계는?", explanation: "항등함수는 반드시 f: X→X 형태여야 합니다. 정의역과 공역이 같아야 항등함수입니다." },
              { question: "정의역의 원소가 하나뿐이면, 상수함수도 일대일함수가 될 수 있다.", answer: "O", hint: "원소가 하나일 때를 생각해보세요.", explanation: "정의역이 {a}이고 f(a)=c인 상수함수는 서로 다른 정의역 원소가 없으므로 자동으로 일대일함수 조건을 만족합니다." },
              { question: "항등함수 정의에서 '정의역=공역' 조건은 없어도 된다.", answer: "X", hint: "항등함수의 핵심 조건을 생각해보세요.", explanation: "항등함수는 정의역과 공역이 같아야 한다는 조건이 필수입니다. f: X→X 형태여야 항등함수입니다." }
            ]
          },
          {
            id: 6,
            name: "Thema 6. 합성함수",
            questions: [
              { question: "합성함수 g∘f는 (g∘f)(x)=g(f(x))를 뜻한다.", answer: "O", hint: "합성함수의 정의를 생각해보세요.", explanation: "합성함수 g∘f는 x를 먼저 f에 넣고, 그 결과를 다시 g에 넣는 함수입니다. (g∘f)(x)=g(f(x))입니다." },
              { question: "g∘f를 계산할 때 x를 먼저 g에 넣는다.", answer: "X", hint: "합성 순서를 다시 생각해보세요.", explanation: "g∘f에서는 x를 먼저 f에 넣고, 그 결과 f(x)를 g에 넣습니다. x→f→g 순서입니다." },
              { question: "g∘f는 항상 f∘g와 같다.", answer: "X", hint: "합성 순서를 바꾸면 결과가 같을까요?", explanation: "일반적으로 g∘f≠f∘g입니다. 합성함수는 순서가 바뀌면 다른 함수가 됩니다. 예: f(x)=x+1, g(x)=2x일 때 (g∘f)(x)=2(x+1)=2x+2이지만 (f∘g)(x)=2x+1로 다릅니다." },
              { question: "g∘f가 정의되려면 f의 치역이 g의 정의역에 들어가야 한다.", answer: "O", hint: "f의 출력이 g의 입력이 될 수 있어야 하나요?", explanation: "g∘f가 정의되려면 f의 모든 함숫값이 g의 정의역에 속해야 합니다. 즉, f의 치역 ⊂ g의 정의역이어야 합니다." },
              { question: "아무 함수 두 개도 언제나 합성이 가능하다.", answer: "X", hint: "치역과 정의역의 관계를 생각해보세요.", explanation: "f의 치역이 g의 정의역에 포함되지 않으면 g∘f를 정의할 수 없습니다. 합성 조건을 만족해야 합니다." },
              { question: "f: X→Y, g: Y→Z이면 g∘f: X→Z이다.", answer: "O", hint: "합성함수의 정의역과 공역을 생각해보세요.", explanation: "g∘f는 X의 원소를 f로 Y로 보내고, 다시 g로 Z로 보내므로 g∘f: X→Z입니다." },
              { question: "g(x)=√x, f(x)=x²일 때 f∘g는 모든 실수에서 정의된다.", answer: "X", hint: "g(x)=√x의 정의역을 생각해보세요.", explanation: "g(x)=√x는 x≥0에서만 정의되므로, f∘g의 정의역도 x≥0입니다. 모든 실수에서 정의되지 않습니다." },
              { question: "g∘f가 정의되면 그 함수는 언제나 일대일함수이다.", answer: "X", hint: "합성함수가 항상 일대일일까요?", explanation: "g∘f가 일대일함수가 되려면 f와 g가 모두 일대일함수여야 합니다. 둘 중 하나라도 일대일이 아니면 합성함수도 일대일이 아닙니다." },
              { question: "기호 '∘'는 곱셈 기호와 같은 뜻이다.", answer: "X", hint: "합성과 곱셈은 다른 연산인가요?", explanation: "∘는 함수의 합성을 나타내는 기호로, 곱셈과는 완전히 다른 연산입니다. (g∘f)(x)=g(f(x))이지 g(x)·f(x)가 아닙니다." },
              { question: "f, g가 모두 ℝ→ℝ이면 g∘f와 f∘g는 둘 다 정의된다.", answer: "O", hint: "정의역과 공역이 모두 실수 전체일 때를 생각해보세요.", explanation: "f와 g의 치역이 모두 ℝ에 포함되고, 정의역도 모두 ℝ이므로 g∘f와 f∘g 모두 정의됩니다." },
              { question: "합성 순서를 바꾸면 정의역·공역이 달라질 수도 있다.", answer: "O", hint: "f: X→Y, g: Y→Z일 때를 생각해보세요.", explanation: "f: X→Y, g: Y→Z일 때 g∘f: X→Z이지만, f∘g는 정의조차 안 될 수 있습니다. 정의된다 해도 정의역·공역이 다를 수 있습니다." },
              { question: "f의 치역이 g의 정의역과 일부만 겹쳐도 g∘f를 정의할 수 있다.", answer: "X", hint: "f의 '모든' 함숫값이 g에 들어갈 수 있어야 하나요?", explanation: "g∘f가 정의되려면 f의 치역 전체가 g의 정의역에 포함되어야 합니다. 일부만 겹치면 일부 함숫값에 대해 g가 정의되지 않아 합성할 수 없습니다." }
            ]
          },
          {
            id: 7,
            name: "Thema 7. 합성함수의 성질",
            questions: [
              { question: "대부분의 f, g에 대해 g∘f = f∘g다.", answer: "X", hint: "합성함수의 교환법칙이 성립하나요?", explanation: "일반적으로 g∘f ≠ f∘g입니다. 합성함수는 교환법칙이 성립하지 않습니다. 예: f(x)=x+1, g(x)=2x일 때 (g∘f)(x)=2x+2이지만 (f∘g)(x)=2x+1로 다릅니다." },
              { question: "(f∘g)∘h = f∘(g∘h)이다.", answer: "O", hint: "합성함수의 결합법칙을 생각해보세요.", explanation: "합성함수는 결합법칙이 성립합니다. 어느 쪽을 먼저 합성해도 결과가 같으므로 (f∘g)∘h = f∘(g∘h)입니다." },
              { question: "항등함수 I와 합성하면 f∘I = f, I∘f = f이다.", answer: "O", hint: "항등함수의 성질을 생각해보세요.", explanation: "항등함수 I(x)=x는 합성에서 항등원 역할을 합니다. f∘I(x)=f(I(x))=f(x)이고 I∘f(x)=I(f(x))=f(x)입니다." },
              { question: "g∘f와 f∘g는 이름만 다르고 같은 뜻이다.", answer: "X", hint: "합성 순서가 중요한가요?", explanation: "g∘f와 f∘g는 완전히 다른 함수입니다. 합성 순서가 바뀌면 일반적으로 다른 결과가 나옵니다." },
              { question: "I를 여러 번 끼워도 f∘I∘I = f이다.", answer: "O", hint: "항등함수를 여러 번 합성하면?", explanation: "항등함수는 몇 번을 합성해도 항등함수입니다. I∘I=I이므로 f∘I∘I=f∘I=f입니다." },
              { question: "g∘f가 정의되면 자동으로 f∘g도 정의된다.", answer: "X", hint: "역방향의 합성 조건을 생각해보세요.", explanation: "g∘f가 정의되려면 f의 치역⊂g의 정의역이어야 하지만, f∘g가 정의되려면 g의 치역⊂f의 정의역이어야 합니다. 둘은 별개의 조건입니다." },
              { question: "결합법칙이 성립하니, 괄호는 마음대로 없애도 된다.", answer: "O", hint: "결합법칙의 의미를 생각해보세요.", explanation: "합성의 정의역 조건만 만족한다면, 결합법칙에 의해 괄호를 어떻게 묶든 결과가 같으므로 괄호를 생략할 수 있습니다." },
              { question: "g∘f와 f∘g가 우연히 같을 수도 있다.", answer: "O", hint: "항상 다른 것은 아닌가요?", explanation: "일반적으로는 다르지만, 특수한 경우에는 같을 수 있습니다. 예: f(x)=x, g(x)=x+1이면 둘 다 정의되고 같을 수 있는 경우도 있습니다. 또는 f=g=I(항등함수)인 경우 같습니다." },
              { question: "합성함수에서 항등함수는 무시 가능하다.", answer: "O", hint: "항등함수의 역할을 생각해보세요.", explanation: "항등함수는 합성에서 아무 영향을 주지 않으므로 f∘I=I∘f=f로 무시할 수 있습니다." }
            ]
          },
          {
            id: 8,
            name: "Thema 8. 역함수",
            questions: [
              { question: "역함수는 입력값과 출력값을 바꾼 함수다.", answer: "O", hint: "역함수의 개념을 생각해보세요.", explanation: "역함수는 원래 함수의 정의역과 치역을 바꾸어 대응 방향을 반대로 한 함수입니다. f(a)=b이면 f⁻¹(b)=a입니다." },
              { question: "y=f(x)이면 x=f⁻¹(y)가 된다.", answer: "O", hint: "역함수의 정의를 생각해보세요.", explanation: "역함수의 정의에 의해 y=f(x) ⟺ x=f⁻¹(y)입니다. 입력과 출력의 관계가 바뀝니다." },
              { question: "역함수가 존재한다 ⟺ 함수가 일대일대응이다.", answer: "O", hint: "역함수 존재 조건을 생각해보세요.", explanation: "함수가 일대일대응일 때만 역함수가 존재합니다. 일대일이 아니거나 치역≠공역이면 역함수가 존재하지 않습니다." },
              { question: "역함수의 공역은 원래 함수의 정의역이다.", answer: "O", hint: "f: X→Y일 때 f⁻¹는?", explanation: "f: X→Y가 일대일대응이면 f⁻¹: Y→X입니다. 역함수의 정의역은 원함수의 공역(치역), 역함수의 공역은 원함수의 정의역입니다." },
              { question: "식만 바꾸면 언제나 역함수가 생긴다.", answer: "X", hint: "역함수 존재 조건을 생각해보세요.", explanation: "역함수가 존재하려면 원함수가 일대일대응이어야 합니다. 식을 x에 대해 풀 수 있어도 일대일대응이 아니면 역함수가 아닙니다." },
              { question: "역함수가 존재하지 않는 예: 어떤 y에 대해 x가 두 개 나온다.", answer: "O", hint: "일대일 조건을 생각해보세요.", explanation: "하나의 y에 대응되는 x가 두 개 이상이면 일대일함수가 아니므로 역함수가 존재하지 않습니다. 예: y=x²는 y=4일 때 x=±2로 두 개입니다." },
              { question: "역함수가 존재하지 않는 예: 어떤 y에 대해 해당하는 x가 아예 없다.", answer: "O", hint: "치역=공역 조건을 생각해보세요.", explanation: "공역의 어떤 원소에 대응되는 정의역 원소가 없으면 치역≠공역이므로 일대일대응이 아니고, 따라서 역함수가 존재하지 않습니다." },
              { question: "f⁻¹가 존재하면 f와 f⁻¹는 서로의 역함수다.", answer: "O", hint: "역함수의 역함수를 생각해보세요.", explanation: "f⁻¹가 f의 역함수이면, f는 f⁻¹의 역함수입니다. (f⁻¹)⁻¹=f가 성립합니다." },
              { question: "f⁻¹가 존재하면 f의 치역과 공역은 달라도 된다.", answer: "X", hint: "일대일대응의 조건을 생각해보세요.", explanation: "역함수가 존재하려면 f가 일대일대응이어야 하고, 일대일대응의 필수 조건은 치역=공역입니다. 따라서 치역과 공역은 같아야 합니다." }
            ]
          },
          {
            id: 9,
            name: "Thema 9. 역함수의 성질",
            questions: [
              { question: "역함수에 다시 역함수를 취하면 원래 함수가 된다: (f⁻¹)⁻¹=f.", answer: "O", hint: "역함수의 역함수를 생각해보세요.", explanation: "역함수는 대응을 반대로 하는 것이므로, 두 번 반대로 하면 원래대로 돌아옵니다. (f⁻¹)⁻¹=f입니다." },
              { question: "(f∘g)⁻¹=g⁻¹∘f⁻¹이다.", answer: "O", hint: "합성함수의 역함수 순서를 생각해보세요.", explanation: "합성함수의 역함수는 순서가 바뀝니다. x→g→f로 갔다면, 되돌릴 때는 f⁻¹→g⁻¹ 순서로 가야 하므로 (f∘g)⁻¹=g⁻¹∘f⁻¹입니다." },
              { question: "f⁻¹가 존재하려면 f가 일대일대응이어야 한다.", answer: "O", hint: "역함수 존재 조건을 생각해보세요.", explanation: "역함수가 존재하려면 원함수가 일대일대응이어야 합니다. 일대일이면서 치역=공역이어야 합니다." },
              { question: "역함수가 있으면 함수와 역함수를 '앞으로 가기/뒤로 가기'로 생각할 수 있다.", answer: "O", hint: "역함수의 의미를 생각해보세요.", explanation: "f는 X에서 Y로 가는 것이고, f⁻¹는 Y에서 X로 되돌아가는 것이므로 앞으로 가기/뒤로 가기 관계입니다." },
              { question: "합성함수의 역함수에서 순서가 바뀌는 이유는 되돌리는 순서가 반대이기 때문이다.", answer: "O", hint: "신발과 양말의 예를 생각해보세요.", explanation: "신발과 양말을 신을 때는 양말→신발 순서지만, 벗을 때는 신발→양말 순서로 반대가 됩니다. 마찬가지로 합성의 역함수도 순서가 반대입니다." },
              { question: "f와 g가 서로 역함수 관계이면 (g∘f)(x)=x이다.", answer: "O", hint: "역함수를 합성하면?", explanation: "f와 f⁻¹가 역함수 관계이면 f⁻¹∘f=I(항등함수)입니다. 따라서 (f⁻¹∘f)(x)=x가 성립합니다." },
              { question: "f⁻¹∘f가 항등함수여도 f∘f⁻¹는 항등함수가 아닐 수 있다.", answer: "X", hint: "역함수의 성질을 생각해보세요.", explanation: "f와 f⁻¹가 역함수 관계이면 f⁻¹∘f와 f∘f⁻¹ 모두 항등함수입니다. 단, 정의역이 다를 수 있습니다: f⁻¹∘f는 f의 정의역에서, f∘f⁻¹는 f의 공역(치역)에서 항등함수입니다." },
              { question: "역함수가 존재하지 않으면 (f⁻¹)⁻¹ 같은 식은 의미가 없다.", answer: "O", hint: "f⁻¹가 없으면?", explanation: "f⁻¹가 존재하지 않으면 (f⁻¹)⁻¹를 정의할 수 없습니다. 역함수가 없는 함수에 대해서는 이러한 표기가 의미가 없습니다." },
              { question: "f가 일대일대응이면 정의역과 공역을 서로 바꾸어 역함수가 만들어진다.", answer: "O", hint: "역함수의 정의를 생각해보세요.", explanation: "f: X→Y가 일대일대응이면 f⁻¹: Y→X가 존재합니다. 정의역과 공역이 바뀌고 대응 방향이 반대가 됩니다." }
            ]
          },
          {
            id: 10,
            name: "Thema 10. 역함수 만들기",
            questions: [
              { question: "역함수를 만들 때 첫 단계는 해당 함수가 일대일대응인지 확인하는 것이다.", answer: "O", hint: "역함수 존재 조건을 먼저 확인해야 하나요?", explanation: "역함수가 존재하려면 함수가 일대일대응이어야 하므로, 먼저 이를 확인해야 합니다." },
              { question: "y=f(x)에서 x와 y의 자리를 바꾸는 것이 역함수 만들기의 핵심 단계다.", answer: "O", hint: "입력과 출력을 바꾸려면?", explanation: "역함수는 입력과 출력을 바꾼 것이므로, y=f(x)를 x=f(y)로 바꾸는 것이 핵심입니다." },
              { question: "자리를 바꾼 뒤에는 식을 y에 대해 풀어 y=f⁻¹(x) 꼴로 만든다.", answer: "O", hint: "역함수의 최종 형태는?", explanation: "x=f(y)를 y에 대해 정리하면 y=f⁻¹(x) 형태로 역함수를 얻을 수 있습니다." },
              { question: "정의역이 실수 전체인 일차함수(기울기 a≠0)는 일대일대응이다.", answer: "O", hint: "일차함수의 성질을 생각해보세요.", explanation: "기울기가 0이 아닌 일차함수 f(x)=ax+b (a≠0)는 정의역과 공역이 실수 전체일 때 일대일대응입니다." },
              { question: "역함수를 구하면 원래 함수의 치역과 정의역이 서로 바뀐다.", answer: "O", hint: "f: X→Y일 때 f⁻¹는?", explanation: "f: X→Y가 일대일대응이면 f⁻¹: Y→X입니다. 정의역과 치역(공역)이 서로 바뀝니다." },
              { question: "역함수는 원래 함수와 항상 같은 식 형태로 나온다.", answer: "X", hint: "f(x)=2x의 역함수를 생각해보세요.", explanation: "일반적으로 역함수의 식은 원래 함수와 다릅니다. 예: f(x)=2x의 역함수는 f⁻¹(x)=x/2입니다." },
              { question: "역함수를 직접 구하지 않고 f(a)=b ⇒ f⁻¹(b)=a 같은 역대응 성질로 풀 수도 있다.", answer: "O", hint: "역함수의 정의를 활용하면?", explanation: "f(a)=b이면 f⁻¹(b)=a라는 역함수의 기본 성질을 이용하여 역함수의 값을 구할 수 있습니다." },
              { question: "f(x)=−x+6은 자기 자신의 역함수다.", answer: "O", hint: "역함수를 직접 구해보세요.", explanation: "y=-x+6을 x에 대해 풀면 x=-y+6이므로 y=-x+6입니다. 역함수가 자기 자신과 같습니다." },
              { question: "y=x는 자기 자신이 역함수인 대표 예다.", answer: "O", hint: "항등함수를 생각해보세요.", explanation: "f(x)=x의 역함수는 f⁻¹(x)=x로 자기 자신입니다. 이는 대표적인 자기역함수 예시입니다." },
              { question: "(f∘g)⁻¹=f⁻¹∘g⁻¹이다.", answer: "X", hint: "합성함수의 역함수 순서를 기억하세요.", explanation: "합성함수의 역함수는 순서가 바뀝니다. (f∘g)⁻¹=g⁻¹∘f⁻¹입니다." },
              { question: "역함수 만들기에서 x와 y의 자리 바꾸기를 생략해도 상관없다.", answer: "X", hint: "자리 바꾸기가 왜 필요한가요?", explanation: "x와 y의 자리를 바꾸는 것은 입력과 출력을 바꾸는 핵심 단계로, 생략하면 역함수를 제대로 구할 수 없습니다." }
            ]
          },
          {
            id: 11,
            name: "Thema 11. 역함수 그래프",
            questions: [
              { question: "역함수 그래프는 원래 그래프를 y=x에 대해 대칭이동한 것이다.", answer: "O", hint: "역함수 그래프의 특징을 생각해보세요.", explanation: "역함수는 x와 y를 바꾼 것이므로, 그래프는 직선 y=x에 대해 대칭입니다." },
              { question: "f가 점 (a, b)를 지나면, f⁻¹는 (b, a)를 지난다.", answer: "O", hint: "역함수에서 입력과 출력이 바뀌면?", explanation: "f(a)=b이면 f⁻¹(b)=a이므로, f의 점 (a,b)는 f⁻¹의 점 (b,a)에 대응됩니다." },
              { question: "직선 y=x는 점 A(a,b)와 B(b,a)를 잇는 선분의 수직이등분선이다.", answer: "O", hint: "두 점의 중점과 기울기를 생각해보세요.", explanation: "중점은 ((a+b)/2, (a+b)/2)로 y=x 위에 있고, AB의 기울기는 (a-b)/(b-a)=-1로 y=x의 기울기 1과 수직입니다." },
              { question: "f의 y절편이 5이면, f⁻¹의 y절편도 5이다.", answer: "X", hint: "y절편과 x절편의 관계를 생각해보세요.", explanation: "f의 y절편이 5이면 점 (0,5)를 지나고, f⁻¹는 점 (5,0)을 지나므로 f⁻¹의 x절편이 5입니다. f⁻¹의 y절편은 f의 x절편과 같습니다." },
              { question: "f와 f⁻¹의 모든 교점은 반드시 y=x 위에 있다.", answer: "X", hint: "y=x 밖에서도 만날 수 있나요?", explanation: "f와 f⁻¹가 만나는 점이 y=x 위에만 있는 것은 아닙니다. y=x에 대해 대칭인 두 점에서도 만날 수 있습니다." },
              { question: "f와 f⁻¹의 교점은 항상 한 개만 나온다.", answer: "X", hint: "교점이 여러 개일 수 있나요?", explanation: "f와 f⁻¹는 여러 점에서 만날 수 있습니다. 교점의 개수는 함수에 따라 다릅니다." },
              { question: "y축 대칭을 하면 역함수 그래프가 된다.", answer: "X", hint: "어떤 직선에 대해 대칭인가요?", explanation: "역함수 그래프는 y=x에 대해 대칭이지, y축에 대해 대칭이 아닙니다." },
              { question: "f와 f⁻¹의 교점을 찾을 때, 보통 f(x)=x를 먼저 푼다.", answer: "O", hint: "y=x 위의 교점을 찾으려면?", explanation: "f와 f⁻¹의 교점 중 y=x 위에 있는 점들은 f(x)=x를 만족합니다. 이를 먼저 풀어 교점을 찾을 수 있습니다." },
              { question: "f와 f⁻¹의 교점이 y=x 밖에도 있을 수 있다.", answer: "O", hint: "대칭인 두 점에서 만날 수 있나요?", explanation: "f와 f⁻¹가 y=x에 대해 대칭인 점에서 동시에 만나면, y=x 밖의 교점이 생깁니다. 예: 두 그래프가 점 (a,b)와 (b,a)에서 교차하는 경우입니다." },
              { question: "y=f(x)와 y=f⁻¹(x)의 그래프는 서로 평행하다.", answer: "X", hint: "대칭 관계를 생각해보세요.", explanation: "역함수 그래프는 원함수 그래프와 y=x에 대해 대칭이지, 평행하지 않습니다." },
              { question: "f와 f⁻¹가 교점을 갖지 않는 경우도 있다.", answer: "O", hint: "f(x)=x를 만족하는 점이 없을 수 있나요?", explanation: "f와 f⁻¹가 만나려면 f(x)=x를 만족하는 점이 있어야 합니다. 하지만 어떤 함수는 f(x)=x를 만족하는 점이 없어 교점이 존재하지 않을 수 있습니다. 예: f(x)=x+1은 f(x)=x를 만족하는 x가 없습니다." }
            ]
          },
          {
            id: 12,
            name: "Thema 12. 우함수·기함수",
            questions: [
              { question: "우함수는 그래프가 y축 대칭이다.", answer: "O", hint: "우함수의 그래프 특징을 생각해보세요.", explanation: "우함수는 f(-x)=f(x)를 만족하므로, 그래프가 y축에 대해 대칭입니다." },
              { question: "기함수는 그래프가 원점 대칭이다.", answer: "O", hint: "기함수의 그래프 특징을 생각해보세요.", explanation: "기함수는 f(-x)=-f(x)를 만족하므로, 그래프가 원점에 대해 대칭입니다." },
              { question: "우함수의 정의는 f(−x)=−f(x)이다.", answer: "X", hint: "우함수와 기함수의 정의를 확인하세요.", explanation: "f(-x)=-f(x)는 기함수의 정의입니다. 우함수의 정의는 f(-x)=f(x)입니다." },
              { question: "기함수의 정의는 f(−x)=−f(x)이다.", answer: "O", hint: "기함수의 정의를 생각해보세요.", explanation: "기함수는 f(-x)=-f(x)를 만족하는 함수입니다." },
              { question: "상수함수 y=8은 기함수이다.", answer: "X", hint: "상수함수는 어떤 대칭성을 가지나요?", explanation: "상수함수는 f(-x)=8=f(x)를 만족하므로 우함수입니다. 기함수가 되려면 f(-x)=-f(x)이어야 합니다." },
              { question: "다항식이 홀수차 항만 있으면 기함수다.", answer: "O", hint: "x, x³, x⁵ 같은 항들을 생각해보세요.", explanation: "홀수차 항들은 모두 f(-x)=-f(x)를 만족하므로, 홀수차 항만 있는 다항식은 기함수입니다." },
              { question: "y=2x⁴+6x²+8은 기함수다.", answer: "X", hint: "각 항의 차수를 확인해보세요.", explanation: "이 함수는 짝수차 항(x⁴, x², 상수)만 있으므로 우함수입니다. f(-x)=2x⁴+6x²+8=f(x)입니다." },
              { question: "기함수 ± 기함수 = 기함수.", answer: "O", hint: "f(-x)=-f(x), g(-x)=-g(x)일 때를 생각해보세요.", explanation: "(f±g)(-x)=f(-x)±g(-x)=-f(x)±(-g(x))=-(f(x)±g(x))이므로 기함수의 합과 차는 기함수입니다." },
              { question: "우함수 × 우함수 = 우함수.", answer: "O", hint: "f(-x)=f(x), g(-x)=g(x)일 때를 생각해보세요.", explanation: "(f·g)(-x)=f(-x)·g(-x)=f(x)·g(x)이므로 우함수의 곱은 우함수입니다." },
              { question: "기함수 × 기함수 = 기함수.", answer: "X", hint: "기함수의 성질 f(-x)=-f(x)를 생각하고, 두 기함수를 곱하면 부호가 어떻게 되나요?", explanation: "(f·g)(-x)=f(-x)·g(-x)=(-f(x))·(-g(x))=f(x)·g(x)이므로 기함수의 곱은 우함수입니다." },
              { question: "우함수 × 기함수 = 기함수.", answer: "O", hint: "짝수 × 홀수는?", explanation: "(f·g)(-x)=f(-x)·g(-x)=f(x)·(-g(x))=-(f(x)·g(x))이므로 우함수와 기함수의 곱은 기함수입니다." },
              { question: "기함수∘기함수 = 우함수.", answer: "X", hint: "합성 함수의 성질을 생각해보세요.", explanation: "(f∘g)(-x)=f(g(-x))=f(-g(x))=-f(g(x))이므로 기함수의 합성은 기함수입니다." },
              { question: "기함수∘우함수 = 우함수.", answer: "O", hint: "안쪽 함수가 우함수면?", explanation: "f가 기함수, g가 우함수일 때 (f∘g)(-x)=f(g(-x))=f(g(x))이므로 기함수∘우함수는 우함수입니다. g가 우함수라서 g(-x)=g(x)이고, 같은 값이 f에 들어가므로 결과도 같습니다." }
            ]
          },
          {
            id: 13,
            name: "Thema 13. 그래프의 대칭성",
            questions: [
              { question: "두 x절편이 x=a, x=b이고 a+b=2m이면 그래프는 직선 x=m에 대칭이다.", answer: "O", hint: "두 x절편의 중점을 생각해보세요.", explanation: "두 x절편의 중점이 (a+b)/2=m이므로, 그래프는 직선 x=m에 대해 대칭입니다." },
              { question: "x₁+x₂=10인 두 x절편을 가지면 대칭축은 x=5이다.", answer: "O", hint: "두 x절편의 평균을 구해보세요.", explanation: "두 x절편의 합이 10이면 중점은 10/2=5이므로, 대칭축은 x=5입니다." },
              { question: "f(a−x)+f(a+x)=0이면 그래프는 점 (2a,0)에 대하여 점대칭이다.", answer: "X", hint: "점대칭의 중심을 다시 확인해보세요.", explanation: "f(a-x)+f(a+x)=0이면 그래프는 점 (a,0)에 대해 점대칭입니다. 2a가 아니라 a입니다." },
              { question: "f(a−x)+f(a+x)=2b이면 그래프는 점 (a,0)에 대하여 점대칭이다.", answer: "X", hint: "y좌표가 0인지 확인해보세요.", explanation: "f(a-x)+f(a+x)=2b이면 그래프는 점 (a,b)에 대해 점대칭입니다. y좌표는 b입니다." },
              { question: "f(x)+f(2a−x)=0도 점 (a,0)에 대한 점대칭 조건이 될 수 있다.", answer: "O", hint: "식을 변형해보세요.", explanation: "f(x)+f(2a-x)=0은 f(a-(a-x))+f(a+(a-x))=0과 같은 형태로, 점 (a,0) 점대칭 조건입니다." },
              { question: "f(a−x)=f(a+x)이면 그래프는 직선 x=a에 대칭이다.", answer: "O", hint: "선대칭 조건을 생각해보세요.", explanation: "f(a-x)=f(a+x)는 x=a를 중심으로 같은 거리에 있는 점들의 함숫값이 같다는 의미로, 직선 x=a에 대해 대칭입니다." },
              { question: "f(x)=f(2a−x)는 점 (a,0)에 대한 점대칭을 뜻한다.", answer: "X", hint: "등호로 연결된 식은 어떤 대칭인가요?", explanation: "f(x)=f(2a-x)는 직선 x=a에 대한 선대칭 조건입니다. 점대칭이 아닙니다." },
              { question: "y=2(x−1)+3은 점 (1,2)에 점대칭이다.", answer: "X", hint: "y=2(x-1)+3의 점대칭 중심을 찾아보세요.", explanation: "y=2(x-1)+3 형태에서 점대칭 중심은 (1,3)입니다. (1,2)가 아닙니다." },
              { question: "f(a−x)=−f(a+x)이면 직선 x=a에 대해 선대칭이다.", answer: "X", hint: "부호가 바뀌는 조건은?", explanation: "f(a-x)=-f(a+x)는 점 (a,0)에 대한 점대칭 조건입니다. 선대칭이려면 f(a-x)=f(a+x)여야 합니다." },
              { question: "직선 x=m에 대칭이면, 서로 같은 높이(y값)를 가진 두 점의 x좌표의 합은 항상 2m이다.", answer: "O", hint: "대칭축으로부터의 거리를 생각해보세요.", explanation: "x=m에 대칭이면 대칭인 두 점 (m-d, y)와 (m+d, y)의 x좌표 합은 (m-d)+(m+d)=2m입니다." }
            ]
          }
        ]
      },
      { id: 8, name: "Chapter 8. 유리함수와 무리함수", chapters: [] }
    ];

    // 상태 관리
    const state = {
      userType: null, // 'student' or 'admin'
      studentName: '',
      phone: '',
      teacherName: '', // 학생의 담당 선생님
      adminName: '', // 관리자 이름
      isLoggedIn: false,
      uid: '',
      loading: false,
      selectedCategory: null,
      currentTheme: null,
      currentQuestion: 0,
      answers: {},
      allStudentData: {},
      showResults: false,
      lockTimers: {},
      currentTime: Date.now(),
      autoLogin: false,
      // 관리자 전용
      adminStudents: [], // 관리자가 담당하는 학생 목록
      selectedStudent: null, // 관리자가 선택한 학생
      showAdminRegister: false
    };

    // 자동 로그인 체크
    function checkAutoLogin() {
      const savedName = localStorage.getItem('ox_quiz_student_name');
      const savedPhone = localStorage.getItem('ox_quiz_student_phone');
      const savedTeacher = localStorage.getItem('ox_quiz_teacher_name');
      const autoLoginEnabled = localStorage.getItem('ox_quiz_auto_login') === 'true';

      if (autoLoginEnabled && savedName && savedPhone) {
        console.log('자동 로그인 시도:', savedName);
        state.studentName = savedName;
        state.phone = savedPhone;
        state.teacherName = savedTeacher || '';
        state.autoLogin = true;
        state.userType = 'student';
        return true;
      }
      return false;
    }

    // 로그인 정보 저장
    function saveLoginInfo(name, phone, teacher, autoLogin) {
      localStorage.setItem('ox_quiz_student_name', name);
      localStorage.setItem('ox_quiz_student_phone', phone);
      localStorage.setItem('ox_quiz_teacher_name', teacher);
      localStorage.setItem('ox_quiz_auto_login', autoLogin ? 'true' : 'false');
    }

    // 로그아웃
    function logout() {
      localStorage.removeItem('ox_quiz_student_name');
      localStorage.removeItem('ox_quiz_student_phone');
      localStorage.removeItem('ox_quiz_teacher_name');
      localStorage.removeItem('ox_quiz_auto_login');
      state.isLoggedIn = false;
      state.userType = null;
      state.studentName = '';
      state.phone = '';
      state.teacherName = '';
      state.adminName = '';
      state.uid = '';
      state.selectedCategory = null;
      state.currentTheme = null;
      state.autoLogin = false;
      state.adminStudents = [];
      state.selectedStudent = null;
      render();
    }

    // Firebase 함수
    async function loadData(id) {
      try {
        const doc = await db.collection('students').doc(id).get();
        if (doc.exists) {
          const studentData = doc.data();
          state.allStudentData[state.studentName] = studentData;
          state.lockTimers = studentData.lockTimers || {};
          // 기존 데이터에서 teacherName 가져오기
          if (!state.teacherName && studentData.teacherName) {
            state.teacherName = studentData.teacherName;
          }
        } else {
          state.allStudentData[state.studentName] = { 
            attempts: [],
            lockTimers: {},
            teacherName: state.teacherName,
            studentName: state.studentName,
            phone: state.phone
          };
          state.lockTimers = {};
        }
        console.log('데이터 로드 완료:', state.allStudentData[state.studentName]);
      } catch (error) {
        console.error('데이터 로드 오류:', error);
        state.allStudentData[state.studentName] = { 
          attempts: [],
          lockTimers: {},
          teacherName: state.teacherName,
          studentName: state.studentName,
          phone: state.phone
        };
        state.lockTimers = {};
      }
    }

    async function saveData(newData) {
      try {
        if (navigator.onLine) {
          await db.collection('students').doc(state.uid).set(newData);
          console.log('온라인 저장 완료');
        } else {
          await saveToIndexedDB(newData);
          console.log('오프라인 임시 저장 완료');
          alert('오프라인 상태입니다. 온라인 복구 시 자동으로 동기화됩니다.');
        }
      } catch (error) {
        console.error('데이터 저장 오류:', error);
        await saveToIndexedDB(newData);
        alert('데이터를 로컬에 임시 저장했습니다.');
      }
    }

    // 관리자 함수
    async function loadAdminStudents(teacherName) {
      try {
        const snapshot = await db.collection('students')
          .where('teacherName', '==', teacherName)
          .get();
        
        const students = [];
        snapshot.forEach(doc => {
          students.push({
            id: doc.id,
            ...doc.data()
          });
        });
        
        state.adminStudents = students;
        console.log('학생 목록 로드 완료:', students.length, '명');
      } catch (error) {
        console.error('학생 목록 로드 오류:', error);
        state.adminStudents = [];
      }
    }

    async function registerAdmin(adminName, secretKey) {
      if (secretKey !== ADMIN_SECRET_KEY) {
        alert('보안 키가 올바르지 않습니다.');
        return false;
      }

      try {
        const adminId = `admin_${adminName}`;
        // students 컬렉션에 관리자 정보 저장 (isAdmin: true 플래그 추가)
        await db.collection('students').doc(adminId).set({
          name: adminName,
          isAdmin: true,
          registeredAt: new Date().toISOString()
        });
        
        alert('관리자 등록이 완료되었습니다!');
        return true;
      } catch (error) {
        console.error('관리자 등록 오류:', error);
        alert('관리자 등록 중 오류가 발생했습니다: ' + error.message);
        return false;
      }
    }

    async function checkAdminExists(adminName) {
      try {
        const adminId = `admin_${adminName}`;
        const doc = await db.collection('students').doc(adminId).get();
        return doc.exists && doc.data()?.isAdmin === true;
      } catch (error) {
        console.error('관리자 확인 오류:', error);
        return false;
      }
    }

    // 유틸리티 함수
    function getThemeStatus(categoryId, themeId) {
      const attempts = state.allStudentData[state.studentName]?.attempts || [];
      const themeAttempts = attempts.filter(a => a.categoryId === categoryId && a.themeId === themeId);
      
      if (themeAttempts.length === 0) return { status: 'new', lastAttempt: null, attemptCount: 0 };
      
      const lastAttempt = themeAttempts[themeAttempts.length - 1];
      const percentage = lastAttempt.percentage;
      
      return { 
        status: percentage === 100 ? 'completed' : 'retry', 
        lastAttempt, 
        attemptCount: themeAttempts.length
      };
    }

    function isLocked(categoryId, themeId) {
      const lockUntil = state.lockTimers[`${state.studentName}-${categoryId}-${themeId}`];
      if (!lockUntil) return false;
      return state.currentTime < lockUntil;
    }

    function getRemainingTime(categoryId, themeId) {
      const lockUntil = state.lockTimers[`${state.studentName}-${categoryId}-${themeId}`];
      if (!lockUntil) return 0;
      const remaining = Math.max(0, Math.ceil((lockUntil - state.currentTime) / 1000));
      return remaining;
    }

    // 이벤트 핸들러
    async function handleStudentLogin(autoLoginChecked = false, isNewStudent = false) {
      if (state.studentName.trim() && state.phone.trim()) {
        const p = state.phone.replace(/[^0-9]/g, '');
        if (p.length < 10 || p.length > 11) {
          alert('올바른 전화번호를 입력해주세요. (10-11자리)');
          return;
        }

        if (isNewStudent && !state.teacherName.trim()) {
          alert('담당 선생님 성함을 입력해주세요.');
          return;
        }

        state.loading = true;
        render();
        const id = `${state.studentName.trim()}_${p}`;
        state.uid = id;
        
        saveLoginInfo(state.studentName.trim(), p, state.teacherName.trim(), autoLoginChecked);
        
        await loadData(id);
        
        // 신규 학생인 경우 선생님 정보 저장
        if (isNewStudent) {
          const newData = {
            ...state.allStudentData[state.studentName],
            teacherName: state.teacherName.trim(),
            studentName: state.studentName.trim(),
            phone: p
          };
          await saveData(newData);
        }
        
        state.isLoggedIn = true;
        state.userType = 'student';
        state.loading = false;
        render();
      }
    }

    async function handleAdminLogin() {
      if (!state.adminName.trim()) {
        alert('관리자 이름을 입력해주세요.');
        return;
      }

      const adminPassword = document.getElementById('adminPasswordInput')?.value;
      if (!adminPassword) {
        alert('비밀번호를 입력해주세요.');
        return;
      }

      if (adminPassword !== ADMIN_PASSWORD) {
        alert('비밀번호가 올바르지 않습니다.');
        return;
      }

      state.loading = true;
      render();

      const exists = await checkAdminExists(state.adminName.trim());
      
      if (!exists) {
        state.loading = false;
        alert('등록되지 않은 관리자입니다. 먼저 관리자 등록을 진행해주세요.');
        render();
        return;
      }

      await loadAdminStudents(state.adminName.trim());
      
      state.isLoggedIn = true;
      state.userType = 'admin';
      state.loading = false;
      render();
    }

    function handleStartQuiz(themeId) {
      if (isLocked(state.selectedCategory, themeId)) return;
      
      state.currentTheme = themeId;
      state.currentQuestion = 0;
      state.answers = {};
      render();
    }

    function handleAnswer(selectedAnswer) {
      const key = state.currentQuestion;
      if (state.answers[key]) return;

      const category = categories.find(c => c.id === state.selectedCategory);
      const theme = category.chapters.find(t => t.id === state.currentTheme);
      const question = theme.questions[state.currentQuestion];
      const isCorrect = selectedAnswer === question.answer;

      const status = getThemeStatus(state.selectedCategory, state.currentTheme);
      const isRetake = status.attemptCount >= 1;

      state.answers[key] = { selected: selectedAnswer, correct: isCorrect, isRetake };
      render();
    }

    function handleNext() {
      const category = categories.find(c => c.id === state.selectedCategory);
      const theme = category.chapters.find(t => t.id === state.currentTheme);
      if (state.currentQuestion < theme.questions.length - 1) {
        state.currentQuestion++;
        render();
      }
    }

    function handlePrev() {
      if (state.currentQuestion > 0) {
        state.currentQuestion--;
        render();
      }
    }

    async function handleFinishQuiz() {
      const category = categories.find(c => c.id === state.selectedCategory);
      const theme = category.chapters.find(t => t.id === state.currentTheme);
      const correct = Object.values(state.answers).filter(a => a.correct).length;
      const total = theme.questions.length;
      const percentage = Math.round((correct / total) * 100);
      
      const wrongQuestions = theme.questions
        .map((q, idx) => ({ ...q, index: idx }))
        .filter(q => state.answers[q.index] && !state.answers[q.index].correct)
        .map(q => q.question);

      const attemptData = {
        categoryId: state.selectedCategory,
        categoryName: category.name,
        themeId: state.currentTheme,
        themeName: theme.name,
        date: new Date().toLocaleString('ko-KR'),
        correct,
        total,
        percentage,
        wrongQuestions,
        answers: { ...state.answers }
      };

      const newData = {
        ...state.allStudentData[state.studentName],
        attempts: [...(state.allStudentData[state.studentName]?.attempts || []), attemptData],
        teacherName: state.teacherName, // teacherName 항상 포함
        studentName: state.studentName,
        phone: state.phone
      };

      if (percentage < 100) {
        const lockUntil = Date.now() + 60000;
        state.lockTimers[`${state.studentName}-${state.selectedCategory}-${state.currentTheme}`] = lockUntil;
        newData.lockTimers = state.lockTimers;
      }

      state.allStudentData[state.studentName] = newData;
      await saveData(newData);

      state.currentTheme = null;
      state.currentQuestion = 0;
      state.answers = {};
      render();
    }

    // 렌더링 함수
    let isRendering = false;
    function render() {
      if (isRendering) return;
      isRendering = true;
      
      const app = document.getElementById('app');

      if (state.loading) {
        app.innerHTML = `
          <div class="min-h-screen flex items-center justify-center">
            <div class="text-center">
              <div class="w-16 h-16 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
              <p class="text-white font-bold">데이터 불러오는 중...</p>
            </div>
          </div>
        `;
        isRendering = false;
        return;
      }

      if (!state.isLoggedIn) {
        if (state.showAdminRegister) {
          renderAdminRegister(app);
        } else {
          renderLogin(app);
        }
        isRendering = false;
        return;
      }

      if (state.userType === 'admin') {
        renderAdminScreen(app);
      } else {
        renderMainScreen();
      }
      
      isRendering = false;
    }

    function renderLogin(app) {
      app.innerHTML = `
        <div class="min-h-screen flex items-center justify-center p-6">
          <div class="max-w-md w-full">
            <div class="bg-gray-900 rounded-2xl p-8 shadow-2xl border border-orange-500/30">
              <div class="flex justify-center mb-6">
                <div class="w-16 h-16 bg-gradient-to-br from-orange-500 to-orange-600 rounded-full flex items-center justify-center shadow-lg shadow-orange-500/50">
                  ${icon('bookOpen', 'text-white', 32)}
                </div>
              </div>
              <h1 class="text-3xl font-bold text-center mb-2 text-white">OX 퀴즈</h1>
              <h2 class="text-xl text-center mb-8 text-orange-500">공통수학2</h2>
              
              <div class="flex gap-2 mb-6">
                <button id="studentBtn" class="flex-1 py-2 px-4 bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg font-bold text-white text-sm">
                  학생
                </button>
                <button id="adminBtn" class="flex-1 py-2 px-4 bg-gray-800 hover:bg-gray-700 rounded-lg font-bold text-white text-sm transition-all">
                  관리자
                </button>
              </div>

              <div id="loginForm"></div>
            </div>
          </div>
        </div>
      `;

      const studentBtn = document.getElementById('studentBtn');
      const adminBtn = document.getElementById('adminBtn');
      const loginForm = document.getElementById('loginForm');

      function showStudentForm() {
        studentBtn.className = "flex-1 py-2 px-4 bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg font-bold text-white text-sm";
        adminBtn.className = "flex-1 py-2 px-4 bg-gray-800 hover:bg-gray-700 rounded-lg font-bold text-white text-sm transition-all";
        
        loginForm.innerHTML = `
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-semibold mb-2 text-gray-300">학생 이름</label>
              <input
                type="text"
                id="nameInput"
                value="${state.studentName}"
                placeholder="이름을 입력하세요"
                class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-500/20 text-white placeholder-gray-500 transition-all"
              />
            </div>

            <div>
              <label class="block text-sm font-semibold mb-2 text-gray-300">전화번호</label>
              <input
                type="tel"
                id="phoneInput"
                value="${state.phone}"
                placeholder="전화번호 (- 없이)"
                class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-500/20 text-white placeholder-gray-500 transition-all"
              />
              <p class="text-xs text-gray-500 mt-1">예: 01012345678</p>
            </div>

            <div id="teacherField" style="display: none;">
              <label class="block text-sm font-semibold mb-2 text-gray-300">담당 선생님 성함</label>
              <input
                type="text"
                id="teacherInput"
                value="${state.teacherName}"
                placeholder="선생님 성함"
                class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-500/20 text-white placeholder-gray-500 transition-all"
              />
              <p class="text-xs text-gray-500 mt-1">처음 가입시에만 입력</p>
            </div>

            <div class="flex items-center gap-2">
              <input
                type="checkbox"
                id="newStudentCheck"
                class="w-4 h-4 bg-gray-800 border-gray-700 rounded focus:ring-orange-500 focus:ring-2 text-orange-500"
              />
              <label for="newStudentCheck" class="text-sm text-gray-300 cursor-pointer">처음 가입하는 학생입니다</label>
            </div>

            <div>
              <label class="flex items-center cursor-pointer">
                <input
                  type="checkbox"
                  id="autoLoginCheck"
                  ${state.autoLogin ? 'checked' : ''}
                  class="w-4 h-4 bg-gray-800 border-gray-700 rounded focus:ring-orange-500 focus:ring-2 text-orange-500"
                />
                <span class="ml-2 text-sm text-gray-300">자동 로그인</span>
              </label>
              <p class="text-xs text-gray-500 mt-1 ml-6">다음부터 자동으로 로그인됩니다</p>
            </div>
            
            <button
              id="loginBtn"
              class="w-full py-3 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 rounded-xl font-bold text-white transition-all shadow-lg shadow-orange-500/30 hover:shadow-orange-500/50 transform hover:scale-105 active:scale-95"
            >
              시작하기
            </button>
          </div>
        `;

        const nameInput = document.getElementById('nameInput');
        const phoneInput = document.getElementById('phoneInput');
        const teacherInput = document.getElementById('teacherInput');
        const newStudentCheck = document.getElementById('newStudentCheck');
        const teacherField = document.getElementById('teacherField');
        const loginBtn = document.getElementById('loginBtn');

        nameInput.addEventListener('input', (e) => {
          state.studentName = e.target.value;
        });
        
        phoneInput.addEventListener('input', (e) => {
          state.phone = e.target.value;
        });

        teacherInput.addEventListener('input', (e) => {
          state.teacherName = e.target.value;
        });

        newStudentCheck.addEventListener('change', (e) => {
          teacherField.style.display = e.target.checked ? 'block' : 'none';
        });

        phoneInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            const autoLoginChecked = document.getElementById('autoLoginCheck').checked;
            const isNewStudent = newStudentCheck.checked;
            handleStudentLogin(autoLoginChecked, isNewStudent);
          }
        });

        loginBtn.addEventListener('click', () => {
          const autoLoginChecked = document.getElementById('autoLoginCheck').checked;
          const isNewStudent = newStudentCheck.checked;
          handleStudentLogin(autoLoginChecked, isNewStudent);
        });
      }

      function showAdminForm() {
        studentBtn.className = "flex-1 py-2 px-4 bg-gray-800 hover:bg-gray-700 rounded-lg font-bold text-white text-sm transition-all";
        adminBtn.className = "flex-1 py-2 px-4 bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg font-bold text-white text-sm";
        
        loginForm.innerHTML = `
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-semibold mb-2 text-gray-300">관리자 이름</label>
              <input
                type="text"
                id="adminNameInput"
                value="${state.adminName}"
                placeholder="이름을 입력하세요"
                class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-500/20 text-white placeholder-gray-500 transition-all"
              />
            </div>

            <div>
              <label class="block text-sm font-semibold mb-2 text-gray-300">비밀번호</label>
              <input
                type="password"
                id="adminPasswordInput"
                placeholder="비밀번호를 입력하세요"
                class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-500/20 text-white placeholder-gray-500 transition-all"
              />
            </div>
            
            <button
              id="adminLoginBtn"
              class="w-full py-3 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 rounded-xl font-bold text-white transition-all shadow-lg shadow-orange-500/30 hover:shadow-orange-500/50 transform hover:scale-105 active:scale-95"
            >
              로그인
            </button>

            <button
              id="adminRegisterBtn"
              class="w-full py-3 bg-gray-800 hover:bg-gray-700 rounded-xl font-bold text-white transition-all border border-gray-700"
            >
              관리자 등록
            </button>
          </div>
        `;

        const adminNameInput = document.getElementById('adminNameInput');
        const adminPasswordInput = document.getElementById('adminPasswordInput');
        const adminLoginBtn = document.getElementById('adminLoginBtn');
        const adminRegisterBtn = document.getElementById('adminRegisterBtn');

        adminNameInput.addEventListener('input', (e) => {
          state.adminName = e.target.value;
        });

        adminPasswordInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            handleAdminLogin();
          }
        });

        adminLoginBtn.addEventListener('click', handleAdminLogin);
        
        adminRegisterBtn.addEventListener('click', () => {
          state.showAdminRegister = true;
          render();
        });
      }

      studentBtn.addEventListener('click', showStudentForm);
      adminBtn.addEventListener('click', showAdminForm);

      showStudentForm();
    }

    function renderAdminRegister(app) {
      app.innerHTML = `
        <div class="min-h-screen flex items-center justify-center p-6">
          <div class="max-w-md w-full">
            <div class="bg-gray-900 rounded-2xl p-8 shadow-2xl border border-orange-500/30">
              <div class="mb-6">
                <button id="backBtn" class="text-sm text-orange-500 hover:text-orange-400 flex items-center font-semibold">
                  ${icon('chevronLeft', '', 16)}돌아가기
                </button>
              </div>

              <div class="flex justify-center mb-6">
                <div class="w-16 h-16 bg-gradient-to-br from-orange-500 to-orange-600 rounded-full flex items-center justify-center shadow-lg shadow-orange-500/50">
                  ${icon('settings', 'text-white', 32)}
                </div>
              </div>
              
              <h1 class="text-2xl font-bold text-center mb-2 text-white">관리자 등록</h1>
              <p class="text-sm text-center mb-6 text-gray-400">보안 키가 필요합니다</p>
              
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-semibold mb-2 text-gray-300">관리자 이름</label>
                  <input
                    type="text"
                    id="regAdminNameInput"
                    placeholder="이름을 입력하세요"
                    class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-500/20 text-white placeholder-gray-500 transition-all"
                  />
                </div>

                <div>
                  <label class="block text-sm font-semibold mb-2 text-gray-300">보안 키</label>
                  <input
                    type="password"
                    id="secretKeyInput"
                    placeholder="보안 키를 입력하세요"
                    class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-500/20 text-white placeholder-gray-500 transition-all"
                  />
                  <p class="text-xs text-red-400 mt-1">⚠️ 관리자만 알고 있는 보안 키</p>
                </div>
                
                <button
                  id="registerBtn"
                  class="w-full py-3 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 rounded-xl font-bold text-white transition-all shadow-lg shadow-orange-500/30 hover:shadow-orange-500/50 transform hover:scale-105 active:scale-95"
                >
                  등록하기
                </button>
              </div>
            </div>
          </div>
        </div>
      `;

      document.getElementById('backBtn').addEventListener('click', () => {
        state.showAdminRegister = false;
        render();
      });

      const regAdminNameInput = document.getElementById('regAdminNameInput');
      const secretKeyInput = document.getElementById('secretKeyInput');
      const registerBtn = document.getElementById('registerBtn');

      registerBtn.addEventListener('click', async () => {
        const name = regAdminNameInput.value.trim();
        const key = secretKeyInput.value.trim();

        if (!name) {
          alert('이름을 입력해주세요.');
          return;
        }

        if (!key) {
          alert('보안 키를 입력해주세요.');
          return;
        }

        const success = await registerAdmin(name, key);
        if (success) {
          state.showAdminRegister = false;
          render();
        }
      });
    }

    function renderAdminScreen(app) {
      if (state.selectedStudent) {
        renderAdminStudentDetail(app);
        return;
      }

      app.innerHTML = `
        <div class="min-h-screen p-6">
          <div class="max-w-5xl mx-auto">
            <div class="bg-gray-900 rounded-2xl p-6 mb-8 shadow-xl border border-orange-500/30">
              <div class="flex items-center justify-between">
                <div class="flex items-center">
                  <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-orange-600 rounded-full flex items-center justify-center mr-3">
                    ${icon('users', 'text-white')}
                  </div>
                  <div>
                    <h2 class="text-xl font-bold text-white">${state.adminName} 선생님</h2>
                    <p class="text-sm text-gray-400 mt-1">담당 학생 관리</p>
                  </div>
                </div>
                <button id="logoutBtn" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-bold text-white transition-all transform hover:scale-105 active:scale-95 text-sm">
                  로그아웃
                </button>
              </div>
            </div>

            <div class="mb-6">
              <div class="bg-gray-900 rounded-xl p-4 border border-gray-800">
                <div class="flex items-center justify-between">
                  <span class="text-gray-400 text-sm font-semibold">전체 학생 수</span>
                  <span class="text-2xl font-bold text-orange-400">${state.adminStudents.length}명</span>
                </div>
              </div>
            </div>

            ${state.adminStudents.length === 0 ? `
              <div class="bg-gray-900 rounded-2xl p-12 text-center border border-gray-800">
                ${icon('users', 'mx-auto mb-4 text-gray-600', 48)}
                <p class="text-gray-400 font-medium">아직 담당 학생이 없습니다.</p>
                <p class="text-sm text-gray-500 mt-2">학생이 회원가입할 때 선생님 성함을 입력하면 자동으로 연결됩니다.</p>
              </div>
            ` : `
              <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                ${state.adminStudents.map(student => {
                  const attempts = student.attempts || [];
                  const totalAttempts = attempts.length;
                  const avgPercentage = totalAttempts > 0 
                    ? Math.round(attempts.reduce((sum, a) => sum + a.percentage, 0) / totalAttempts)
                    : 0;
                  const completedThemes = attempts.filter(a => a.percentage === 100).length;

                  return `
                    <button
                      data-student="${student.id}"
                      class="student-btn bg-gray-900 rounded-2xl p-6 border border-gray-800 shadow-xl hover:shadow-orange-500/20 hover:border-orange-500/50 transition-all text-left transform hover:scale-105 active:scale-95"
                    >
                      <div class="flex items-center mb-4">
                        <div class="w-10 h-10 bg-gradient-to-br from-orange-500 to-orange-600 rounded-full flex items-center justify-center mr-3">
                          ${icon('user', 'text-white', 20)}
                        </div>
                        <div>
                          <h3 class="text-base font-bold text-white">${student.studentName || '이름 없음'}</h3>
                          <p class="text-xs text-gray-500">${student.phone || ''}</p>
                        </div>
                      </div>
                      
                      <div class="grid grid-cols-3 gap-2 mb-3">
                        <div class="bg-gray-800/50 rounded-lg p-2 text-center">
                          <div class="text-lg font-bold text-orange-400">${totalAttempts}</div>
                          <div class="text-xs text-gray-500">시도</div>
                        </div>
                        <div class="bg-gray-800/50 rounded-lg p-2 text-center">
                          <div class="text-lg font-bold text-green-400">${completedThemes}</div>
                          <div class="text-xs text-gray-500">완료</div>
                        </div>
                        <div class="bg-gray-800/50 rounded-lg p-2 text-center">
                          <div class="text-lg font-bold text-blue-400">${avgPercentage}%</div>
                          <div class="text-xs text-gray-500">평균</div>
                        </div>
                      </div>

                      <div class="text-xs text-gray-400 text-right">
                        자세히 보기 →
                      </div>
                    </button>
                  `;
                }).join('')}
              </div>
            `}
          </div>
        </div>
      `;

      document.getElementById('logoutBtn').addEventListener('click', () => {
        if (confirm('로그아웃 하시겠습니까?')) {
          logout();
        }
      });

      document.querySelectorAll('.student-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const studentId = btn.dataset.student;
          state.selectedStudent = state.adminStudents.find(s => s.id === studentId);
          render();
        });
      });
    }

    function renderAdminStudentDetail(app) {
      const student = state.selectedStudent;
      const attempts = student.attempts || [];

      app.innerHTML = `
        <div class="min-h-screen p-6">
          <div class="max-w-5xl mx-auto">
            <div class="mb-4">
              <button id="backBtn" class="text-sm text-orange-500 hover:text-orange-400 flex items-center font-semibold">
                ${icon('chevronLeft', '', 16)}학생 목록으로 돌아가기
              </button>
            </div>

            <div class="bg-gray-900 rounded-2xl p-6 mb-6 shadow-xl border border-orange-500/30">
              <div class="flex items-center justify-between">
                <div class="flex items-center">
                  <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-orange-600 rounded-full flex items-center justify-center mr-3">
                    ${icon('user', 'text-white')}
                  </div>
                  <div>
                    <h2 class="text-xl font-bold text-white">${student.studentName || '이름 없음'}</h2>
                    <p class="text-sm text-gray-400 mt-1">${student.phone || ''}</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="grid md:grid-cols-4 gap-4 mb-6">
              <div class="bg-gray-900 rounded-xl p-4 border border-gray-800">
                <div class="text-center">
                  <div class="text-2xl font-bold text-orange-400">${attempts.length}</div>
                  <div class="text-xs text-gray-500 mt-1">전체 시도</div>
                </div>
              </div>
              <div class="bg-gray-900 rounded-xl p-4 border border-gray-800">
                <div class="text-center">
                  <div class="text-2xl font-bold text-green-400">${attempts.filter(a => a.percentage === 100).length}</div>
                  <div class="text-xs text-gray-500 mt-1">완료 테마</div>
                </div>
              </div>
              <div class="bg-gray-900 rounded-xl p-4 border border-gray-800">
                <div class="text-center">
                  <div class="text-2xl font-bold text-blue-400">
                    ${attempts.length > 0 ? Math.round(attempts.reduce((sum, a) => sum + a.percentage, 0) / attempts.length) : 0}%
                  </div>
                  <div class="text-xs text-gray-500 mt-1">평균 정답률</div>
                </div>
              </div>
              <div class="bg-gray-900 rounded-xl p-4 border border-gray-800">
                <div class="text-center">
                  <div class="text-2xl font-bold text-purple-400">
                    ${attempts.length > 0 ? Math.round(attempts.reduce((sum, a) => sum + a.correct, 0) / attempts.length) : 0}
                  </div>
                  <div class="text-xs text-gray-500 mt-1">평균 정답 수</div>
                </div>
              </div>
            </div>

            ${attempts.length === 0 ? `
              <div class="bg-gray-900 rounded-2xl p-12 text-center border border-gray-800">
                ${icon('barChart', 'mx-auto mb-4 text-gray-600', 48)}
                <p class="text-gray-400 font-medium">아직 학습 기록이 없습니다.</p>
              </div>
            ` : `
              <div class="space-y-4">
                ${(() => {
                  const themeGroups = {};
                  attempts.forEach(attempt => {
                    const key = `${attempt.categoryName}-${attempt.themeName}`;
                    if (!themeGroups[key]) {
                      themeGroups[key] = [];
                    }
                    themeGroups[key].push(attempt);
                  });

                  return Object.entries(themeGroups).map(([key, themeAttempts]) => {
                    const lastAttempt = themeAttempts[themeAttempts.length - 1];
                    const allWrongQuestions = themeAttempts
                      .flatMap(a => a.wrongQuestions || [])
                      .filter((q, idx, arr) => arr.indexOf(q) === idx);

                    return `
                      <div class="bg-gray-900 rounded-2xl p-6 border border-gray-800 shadow-xl">
                        <div class="flex justify-between items-start mb-4">
                          <div>
                            <h3 class="text-sm font-bold text-gray-400 mb-1">${lastAttempt.categoryName}</h3>
                            <h4 class="text-base font-bold text-white">${lastAttempt.themeName}</h4>
                            <p class="text-xs text-gray-500 mt-1">최근 시도: ${lastAttempt.date}</p>
                          </div>
                          <div class="text-right">
                            <div class="text-2xl font-bold ${lastAttempt.percentage === 100 ? 'text-green-400' : 'text-orange-400'}">
                              ${lastAttempt.percentage}%
                            </div>
                            <div class="text-xs text-gray-500 font-semibold">${lastAttempt.correct} / ${lastAttempt.total}</div>
                          </div>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4 pt-4 border-t border-gray-800 mb-4">
                          <div class="text-center">
                            <div class="text-lg font-bold text-green-400">${lastAttempt.correct}</div>
                            <div class="text-xs text-gray-500">맞힌 개수</div>
                          </div>
                          <div class="text-center">
                            <div class="text-lg font-bold text-red-400">${lastAttempt.total - lastAttempt.correct}</div>
                            <div class="text-xs text-gray-500">틀린 개수</div>
                          </div>
                          <div class="text-center">
                            <div class="text-lg font-bold text-blue-400">${themeAttempts.length}</div>
                            <div class="text-xs text-gray-500">시도 횟수</div>
                          </div>
                        </div>

                        ${allWrongQuestions.length > 0 ? `
                          <div class="bg-red-900/20 border border-red-500/30 rounded-xl p-4">
                            <h4 class="text-sm font-bold text-red-400 mb-3 flex items-center">
                              ${icon('xCircle', 'mr-2', 18)}틀린 문제 목록
                            </h4>
                            <div class="space-y-2">
                              ${allWrongQuestions.map((wrongQ, idx) => `
                                <div class="text-sm bg-gray-900/50 rounded-lg p-3 border border-red-500/20">
                                  <p class="text-red-300 font-medium leading-relaxed">${idx + 1}. ${wrongQ}</p>
                                </div>
                              `).join('')}
                            </div>
                          </div>
                        ` : `
                          <div class="bg-green-900/20 border border-green-500/30 rounded-xl p-4 text-center">
                            <p class="text-green-400 text-sm font-bold">
                              ${icon('checkCircle', 'inline mr-2', 18)}모든 문제를 맞혔습니다!
                            </p>
                          </div>
                        `}
                      </div>
                    `;
                  }).join('');
                })()}
              </div>
            `}
          </div>
        </div>
      `;

      document.getElementById('backBtn').addEventListener('click', () => {
        state.selectedStudent = null;
        render();
      });
    }

    function renderMainScreen() {
      const app = document.getElementById('app');
      const currentStudentAttempts = state.allStudentData[state.studentName]?.attempts || [];

      if (state.showResults) {
        renderResultsScreen(app, currentStudentAttempts);
        return;
      }

      if (!state.selectedCategory) {
        renderCategorySelection(app);
        return;
      }

      if (state.currentTheme === null) {
        renderThemeSelection(app);
        return;
      }

      renderQuizScreen(app);
    }

    function renderCategorySelection(app) {
      app.innerHTML = `
        <div class="min-h-screen p-6">
          <div class="max-w-5xl mx-auto">
            <div class="bg-gray-900 rounded-2xl p-6 mb-8 shadow-xl border border-orange-500/30">
              <div class="flex items-center mb-4">
                <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-orange-600 rounded-full flex items-center justify-center mr-3">
                  ${icon('user', 'text-white')}
                </div>
                <h2 class="text-xl font-bold text-white">${state.studentName}</h2>
              </div>
              <div class="flex gap-2">
                <button id="recordBtn" class="flex items-center px-5 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg font-bold text-white transition-all border border-gray-700 transform hover:scale-105 active:scale-95">
                  ${icon('barChart', 'mr-2', 18)}학습 기록
                </button>
                <button id="logoutBtn" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-bold text-white transition-all transform hover:scale-105 active:scale-95 text-sm">
                  로그아웃
                </button>
              </div>
            </div>

            <div class="grid md:grid-cols-2 gap-4">
              ${categories.map(category => `
                <button
                  data-cat="${category.id}"
                  class="cat-btn bg-gray-900 rounded-2xl p-6 border shadow-xl text-left transition-all transform ${
                    category.chapters.length > 0
                      ? 'border-gray-800 hover:shadow-orange-500/20 hover:border-orange-500/50 hover:scale-105 active:scale-95'
                      : 'border-gray-800 opacity-50 cursor-not-allowed'
                  }"
                  ${category.chapters.length === 0 ? 'disabled' : ''}
                >
                  <h3 class="text-base font-bold text-white mb-2">${category.name}</h3>
                  <p class="text-xs text-gray-500 font-semibold">
                    ${category.chapters.length > 0 ? `${category.chapters.length}개의 테마` : '준비 중'}
                  </p>
                </button>
              `).join('')}
            </div>
          </div>
        </div>
      `;

      document.getElementById('recordBtn').addEventListener('click', () => {
        state.showResults = true;
        render();
      });

      document.getElementById('logoutBtn').addEventListener('click', () => {
        if (confirm('로그아웃 하시겠습니까?')) {
          logout();
        }
      });

      document.querySelectorAll('.cat-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const catId = parseInt(btn.dataset.cat);
          const category = categories.find(c => c.id === catId);
          if (category.chapters.length > 0) {
            state.selectedCategory = catId;
            render();
          }
        });
      });
    }

    function renderThemeSelection(app) {
      const category = categories.find(c => c.id === state.selectedCategory);
      
      app.innerHTML = `
        <div class="min-h-screen p-6">
          <div class="max-w-5xl mx-auto">
            <div class="mb-4">
              <button id="backBtn" class="text-sm text-orange-500 hover:text-orange-400 flex items-center font-semibold">
                ${icon('chevronLeft', '', 16)}챕터 선택으로 돌아가기
              </button>
            </div>

            <div class="bg-gray-900 rounded-2xl p-6 mb-8 shadow-xl border border-orange-500/30">
              <div class="flex items-center justify-between mb-4">
                <div>
                  <h2 class="text-xl font-bold text-white">${category.name}</h2>
                  <p class="text-sm text-gray-400 mt-1 font-medium">테마 선택</p>
                </div>
                <button id="resultsBtn" class="flex items-center px-5 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg font-bold text-white transition-all border border-gray-700 transform hover:scale-105 active:scale-95">
                  ${icon('barChart', 'mr-2', 18)}학습 기록
                </button>
              </div>
              
              ${category.chapterInfo ? `
                <div class="mt-4 pt-4 border-t border-gray-700">
                  <div class="grid grid-cols-2 gap-3">
                    ${category.chapterInfo.map(info => `
                      <div class="bg-gray-800/50 rounded-lg p-3 border border-gray-700">
                        <div class="flex items-baseline gap-2 mb-1">
                          <span class="text-orange-400 font-bold text-xs">${info.partName}</span>
                          <span class="text-gray-300 text-xs font-medium">${info.description}</span>
                        </div>
                        <span class="text-gray-500 text-xs">${info.range}</span>
                      </div>
                    `).join('')}
                  </div>
                </div>
              ` : ''}
            </div>

            <div class="grid md:grid-cols-2 gap-4">
              ${category.chapters.map(theme => {
                const status = getThemeStatus(state.selectedCategory, theme.id);
                const locked = isLocked(state.selectedCategory, theme.id);
                const remainingSeconds = getRemainingTime(state.selectedCategory, theme.id);
                const minutes = Math.floor(remainingSeconds / 60);
                const seconds = remainingSeconds % 60;
                const isCompleted = status.status === 'completed';

                return `
                  <div class="bg-gray-900 rounded-2xl p-6 shadow-xl transition-all relative ${
                    isCompleted 
                      ? 'border-2 border-green-500/50 shadow-green-500/20' 
                      : 'border border-gray-800 hover:shadow-orange-500/20 hover:border-orange-500/50'
                  }">
                    ${isCompleted ? `
                      <div class="absolute top-4 right-4 flex items-center justify-center" style="width: 28px; height: 28px;">
                        <svg style="width:28px;height:28px;flex-shrink:0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-green-500">
                          <circle cx="12" cy="8" r="7"/>
                          <path d="M8.21 13.89 7 23l5-3 5 3-1.21-9.12"/>
                        </svg>
                      </div>
                    ` : ''}
                    
                    <div class="flex items-start justify-between mb-4">
                      <h3 class="text-base font-bold text-white flex-1 pr-8">${theme.name}</h3>
                    </div>
                    
                    <p class="text-xs text-gray-500 mb-4 font-semibold">${theme.questions.length}개 문제</p>
                    
                    ${status.lastAttempt ? `
                      <div class="mb-4 p-4 bg-gray-800/50 rounded-xl border border-gray-700">
                        <p class="text-xs text-gray-500 font-semibold mb-1">최근 시도</p>
                        <p class="text-lg font-bold text-orange-400">
                          ${status.lastAttempt.percentage}% <span class="text-sm text-gray-500">(${status.lastAttempt.correct}/${status.lastAttempt.total})</span>
                        </p>
                        <p class="text-xs text-gray-500 mt-1">시도 횟수: ${status.attemptCount}회</p>
                      </div>
                    ` : ''}

                    ${isCompleted ? `
                      <div class="space-y-2">
                        <div class="w-full py-3 bg-gradient-to-r from-green-500 to-green-600 rounded-xl font-bold text-white text-center flex items-center justify-center text-sm shadow-lg shadow-green-500/30">
                          ${icon('checkCircle', 'mr-2', 18)}퀴즈 완료
                        </div>
                        <button data-theme="${theme.id}" class="start-btn w-full py-2 bg-gray-800 hover:bg-gray-700 rounded-xl font-semibold text-white transition-all text-xs border border-gray-700 transform hover:scale-105 active:scale-95">
                          다시 도전하기
                        </button>
                      </div>
                    ` : locked ? `
                      <div class="space-y-3">
                        <div class="w-full py-3 bg-gray-800/50 rounded-xl font-bold text-gray-400 text-center border border-gray-700 cursor-not-allowed flex items-center justify-center text-sm">
                          ${icon('lock', 'mr-2', 16)}${icon('clock', 'mr-1', 16)}<span data-lock-timer="${theme.id}">${minutes}:${seconds.toString().padStart(2, '0')} 후 재시험 가능</span>
                        </div>
                        <button data-review="${theme.id}" class="review-btn w-full py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 rounded-xl font-bold text-white transition-all text-sm shadow-lg shadow-blue-500/30 hover:shadow-blue-500/50 transform hover:scale-105 active:scale-95 flex items-center justify-center">
                          ${icon('bookOpen', 'mr-2', 18)}힌트 복습하기
                        </button>
                      </div>
                    ` : status.status === 'retry' ? `
                      <button data-theme="${theme.id}" class="start-btn w-full py-3 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 rounded-xl font-bold text-white transition-all text-sm shadow-lg shadow-orange-500/30 hover:shadow-orange-500/50 transform hover:scale-105 active:scale-95">
                        퀴즈 다시 도전하기
                      </button>
                    ` : `
                      <button data-theme="${theme.id}" class="start-btn w-full py-3 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 rounded-xl font-bold text-white transition-all text-sm shadow-lg shadow-orange-500/30 hover:shadow-orange-500/50 transform hover:scale-105 active:scale-95">
                        퀴즈 시작
                      </button>
                    `}
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        </div>
      `;

      document.getElementById('backBtn').addEventListener('click', () => {
        state.selectedCategory = null;
        render();
      });

      document.getElementById('resultsBtn').addEventListener('click', () => {
        state.showResults = true;
        render();
      });

      document.querySelectorAll('.start-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          handleStartQuiz(parseInt(btn.dataset.theme));
        });
      });

      document.querySelectorAll('.review-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          state.showResults = true;
          state.selectedCategory = state.selectedCategory;
          render();
        });
      });
    }

    function renderQuizScreen(app) {
      const category = categories.find(c => c.id === state.selectedCategory);
      if (!category || !category.chapters) {
        app.innerHTML = `<div class="min-h-screen flex items-center justify-center p-6"><p class="text-white">카테고리를 찾을 수 없습니다.</p></div>`;
        return;
      }
      
      const theme = category.chapters.find(t => t.id === state.currentTheme);
      if (!theme || !theme.questions) {
        app.innerHTML = `<div class="min-h-screen flex items-center justify-center p-6"><p class="text-white">테마를 찾을 수 없습니다.</p></div>`;
        return;
      }
      
      const question = theme.questions[state.currentQuestion];
      const answer = state.answers[state.currentQuestion];
      const answeredCount = Object.keys(state.answers).length;
      const correctCount = Object.values(state.answers).filter(a => a.correct).length;
      const incorrectCount = answeredCount - correctCount;
      const isComplete = answeredCount === theme.questions.length;

      app.innerHTML = `
        <div class="min-h-screen p-6">
          <div class="max-w-4xl mx-auto">
            <div class="mb-4">
              <button id="homeBtn" class="text-sm text-orange-500 hover:text-orange-400 flex items-center font-semibold">
                ${icon('home', '', 16)}메인으로 돌아가기
              </button>
            </div>

            <div class="bg-gray-900 rounded-2xl p-5 mb-6 shadow-xl border border-orange-500/30">
              <div class="flex items-center justify-between">
                <div>
                  <h2 class="text-base font-bold text-white">${state.studentName}</h2>
                  <p class="text-xs text-gray-400 mt-1 font-medium">${theme.name}</p>
                </div>
                <div class="text-right">
                  <p class="text-xs text-gray-500 font-semibold">진행 상황</p>
                  <p class="text-lg font-bold text-orange-400">${state.currentQuestion + 1} / ${theme.questions.length}</p>
                </div>
              </div>
            </div>

            <div class="bg-gray-900 rounded-2xl p-6 mb-6 shadow-xl border border-gray-800">
              <div class="grid grid-cols-3 gap-4 text-center">
                <div>
                  <div class="text-2xl font-bold text-green-400">${correctCount}</div>
                  <div class="text-xs text-gray-500 mt-1 font-medium">맞힌 개수</div>
                </div>
                <div>
                  <div class="text-2xl font-bold text-red-400">${incorrectCount}</div>
                  <div class="text-xs text-gray-500 mt-1 font-medium">틀린 개수</div>
                </div>
                <div>
                  <div class="text-2xl font-bold text-orange-400">${answeredCount}</div>
                  <div class="text-xs text-gray-500 mt-1 font-medium">답변 완료</div>
                </div>
              </div>
            </div>

            <div class="bg-gray-900 rounded-2xl p-8 border border-gray-800 shadow-xl mb-6">
              <div class="mb-8">
                <span class="inline-block px-3 py-1 bg-orange-500/20 text-orange-400 rounded-lg text-xs font-bold mb-4">
                  문제 ${state.currentQuestion + 1}
                </span>
                <p class="text-lg leading-relaxed text-white font-medium">${question.question}</p>
              </div>
              
              <div class="flex gap-3 mb-6">
                ${['O', 'X'].map(opt => {
                  let btnClass = 'flex-1 py-4 px-6 rounded-xl font-bold text-2xl transition-all transform ';
                  
                  if (!answer) {
                    btnClass += 'bg-gray-800 hover:bg-gray-700 border-2 border-gray-700 text-white hover:scale-105 active:scale-95 cursor-pointer';
                  } else {
                    if (answer.selected === opt) {
                      if (answer.correct) {
                        btnClass += 'bg-gradient-to-r from-green-500 to-green-600 border-2 border-green-400 text-white shadow-lg shadow-green-500/50';
                      } else {
                        btnClass += 'bg-gradient-to-r from-red-500 to-red-600 border-2 border-red-400 text-white shadow-lg shadow-red-500/50';
                      }
                    } else if (question.answer === opt) {
                      btnClass += 'bg-gradient-to-r from-green-500 to-green-600 border-2 border-green-400 text-white shadow-lg shadow-green-500/50';
                    } else {
                      btnClass += 'bg-gray-800/30 border-2 border-gray-700 opacity-40 text-gray-600';
                    }
                    btnClass += ' cursor-not-allowed';
                  }

                  return `
                    <button data-answer="${opt}" class="answer-btn ${btnClass}">
                      ${answer?.selected === opt ? (answer.correct ? icon('checkCircle', 'inline mr-2', 22) : icon('xCircle', 'inline mr-2', 22)) : ''}
                      ${opt}
                    </button>
                  `;
                }).join('')}
              </div>
              
              ${answer ? `
                <div class="p-5 rounded-xl border-2 ${answer.correct ? 'bg-green-900/20 border-green-500/50' : 'bg-red-900/20 border-red-500/50'}">
                  <p class="font-bold text-sm mb-2" style="color: ${answer.correct ? '#4ade80' : '#f87171'}">
                    ${answer.correct ? '✓ 정답입니다!' : '✗ 오답입니다.'}
                  </p>
                  ${answer.correct ? `
                    <p class="text-sm text-gray-300 leading-relaxed font-medium">
                      <span class="text-green-400 font-bold">해설:</span> ${question.explanation}
                    </p>
                  ` : answer.isRetake ? `
                    <p class="text-sm text-gray-300 leading-relaxed font-medium">
                      <span class="text-orange-400 font-bold">해설:</span> ${question.explanation}
                    </p>
                  ` : `
                    <p class="text-sm text-gray-300 leading-relaxed font-medium">
                      <span class="text-orange-400 font-bold">💡 힌트:</span> ${question.hint}
                    </p>
                  `}
                </div>
              ` : ''}
            </div>

            <div class="flex gap-3">
              <button id="prevBtn" class="flex items-center px-5 py-3 bg-gray-800 hover:bg-gray-700 disabled:bg-gray-800/30 disabled:cursor-not-allowed rounded-xl font-bold transition-all border border-gray-700 disabled:border-gray-800 text-white disabled:text-gray-600 text-sm transform hover:scale-105 active:scale-95 disabled:scale-100" ${state.currentQuestion === 0 ? 'disabled' : ''}>
                ${icon('chevronLeft', 'mr-1', 18)}이전
              </button>
              
              ${state.currentQuestion < theme.questions.length - 1 ? `
                <button id="nextBtn" class="flex-1 flex items-center justify-center px-5 py-3 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 rounded-xl font-bold transition-all text-white text-sm shadow-lg shadow-orange-500/30 hover:shadow-orange-500/50 transform hover:scale-105 active:scale-95">
                  다음${icon('chevronRight', 'ml-1', 18)}
                </button>
              ` : `
                <button id="finishBtn" class="flex-1 px-5 py-3 rounded-xl font-bold transition-all text-sm transform ${
                  isComplete
                    ? correctCount === theme.questions.length
                      ? 'bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white shadow-lg shadow-green-500/30 hover:scale-105 active:scale-95'
                      : 'bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white shadow-lg shadow-orange-500/30 hover:scale-105 active:scale-95'
                    : 'bg-gray-800/30 cursor-not-allowed border border-gray-700 text-gray-600 scale-100'
                }" ${!isComplete ? 'disabled' : ''}>
                  ${isComplete ? '결과 저장하고 완료' : '모든 문제를 풀어주세요'}
                </button>
              `}
            </div>

            ${isComplete ? `
              <div class="mt-6 border-2 rounded-2xl p-6 shadow-xl ${
                correctCount === theme.questions.length 
                  ? 'bg-green-900/20 border-green-500/50' 
                  : 'bg-orange-900/20 border-orange-500/50'
              }">
                <h3 class="text-xl font-bold mb-4 text-center ${
                  correctCount === theme.questions.length ? 'text-green-400' : 'text-orange-400'
                }">
                  ${correctCount === theme.questions.length ? '🎉 완벽합니다!' : '퀴즈 완료!'}
                </h3>
                <p class="text-base text-center mb-3 text-white font-medium">
                  총 ${theme.questions.length}문제 중 <span class="text-green-400 font-bold">${correctCount}문제</span> 맞히셨습니다!
                </p>
                <p class="text-sm text-center mb-4 text-gray-300 font-medium">
                  정답률: <span class="font-bold text-lg ${
                    correctCount === theme.questions.length ? 'text-green-400' : 'text-orange-400'
                  }">
                    ${Math.round((correctCount / theme.questions.length) * 100)}%
                  </span>
                </p>
                ${correctCount < theme.questions.length ? `
                  <p class="text-center text-xs text-gray-400 font-medium">
                    💡 1분 후 재도전 가능. 힌트를 복습하세요!
                  </p>
                ` : ''}
              </div>
            ` : ''}
          </div>
        </div>
      `;

      document.getElementById('homeBtn').addEventListener('click', () => {
        state.selectedCategory = null;
        state.currentTheme = null;
        render();
      });

      if (state.currentQuestion > 0) {
        document.getElementById('prevBtn').addEventListener('click', handlePrev);
      }

      if (state.currentQuestion < theme.questions.length - 1) {
        document.getElementById('nextBtn').addEventListener('click', handleNext);
      } else {
        const finishBtn = document.getElementById('finishBtn');
        if (finishBtn && isComplete) {
          finishBtn.addEventListener('click', async () => {
            console.log('완료 버튼 클릭됨');
            finishBtn.disabled = true;
            finishBtn.textContent = '저장 중...';
            try {
              await handleFinishQuiz();
            } catch (error) {
              console.error('완료 처리 오류:', error);
              alert('오류 발생: ' + error.message);
              finishBtn.disabled = false;
              finishBtn.textContent = '결과 저장하고 완료';
            }
          });
        }
      }

      if (!answer) {
        document.querySelectorAll('.answer-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            handleAnswer(btn.dataset.answer);
          });
        });
      }
    }

    function renderResultsScreen(app, currentStudentAttempts) {
      const categoryAttempts = state.selectedCategory 
        ? currentStudentAttempts.filter(a => a.categoryId === state.selectedCategory)
        : [];

      app.innerHTML = `
        <div class="min-h-screen p-6">
          <div class="max-w-5xl mx-auto">
            <div class="bg-gray-900 rounded-2xl p-6 mb-6 shadow-xl border border-orange-500/30">
              <div class="flex items-center justify-between">
                <div class="flex items-center">
                  <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-orange-600 rounded-full flex items-center justify-center mr-3">
                    ${icon('user', 'text-white')}
                  </div>
                  <div>
                    <h2 class="text-xl font-bold text-white">${state.studentName}</h2>
                    <p class="text-sm text-gray-400">학습 기록</p>
                  </div>
                </div>
                <button id="backBtn" class="px-5 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg font-bold text-white transition-all border border-gray-700 transform hover:scale-105 active:scale-95">
                  돌아가기
                </button>
              </div>
            </div>

            ${state.selectedCategory ? `
              <div class="mb-4">
                <button id="allRecordsBtn" class="text-sm text-orange-500 hover:text-orange-400 flex items-center font-semibold">
                  ${icon('chevronLeft', '', 16)}전체 기록으로 돌아가기
                </button>
              </div>
              
              <h3 class="text-lg font-bold text-white mb-4">
                ${categories.find(c => c.id === state.selectedCategory)?.name}
              </h3>

              ${categoryAttempts.length === 0 ? `
                <div class="bg-gray-900 rounded-2xl p-12 text-center border border-gray-800">
                  ${icon('barChart', 'mx-auto mb-4 text-gray-600', 48)}
                  <p class="text-gray-400 font-medium">이 챕터의 학습 기록이 없습니다.</p>
                </div>
              ` : `
                <div class="space-y-4">
                  ${(() => {
                    const themeGroups = {};
                    categoryAttempts.forEach(attempt => {
                      const key = `${attempt.categoryId}-${attempt.themeId}`;
                      if (!themeGroups[key]) {
                        themeGroups[key] = [];
                      }
                      themeGroups[key].push(attempt);
                    });

                    return Object.entries(themeGroups).map(([key, attempts]) => {
                      const lastAttempt = attempts[attempts.length - 1];
                      const allWrongQuestions = attempts
                        .flatMap(a => a.wrongQuestions || [])
                        .filter((q, idx, arr) => arr.indexOf(q) === idx);

                      const isRetakeAvailable = lastAttempt.percentage < 100;
                      const category = categories.find(c => c.id === lastAttempt.categoryId);
                      const theme = category.chapters.find(t => t.id === lastAttempt.themeId);

                      return `
                        <div class="bg-gray-900 rounded-2xl p-6 border border-gray-800 shadow-xl relative">
                          <div class="flex justify-between items-start mb-4">
                            <div>
                              <h3 class="text-base font-bold text-white mb-1">${lastAttempt.themeName}</h3>
                              <p class="text-xs text-gray-500">최종 시도: ${lastAttempt.date}</p>
                            </div>
                            <div class="text-right">
                              <div class="text-2xl font-bold ${lastAttempt.percentage === 100 ? 'text-green-400' : 'text-orange-400'}">
                                ${lastAttempt.percentage}%
                              </div>
                              <div class="text-xs text-gray-500 font-semibold">${lastAttempt.correct} / ${lastAttempt.total}</div>
                            </div>
                          </div>
                          
                          <div class="grid grid-cols-3 gap-4 pt-4 border-t border-gray-800 mb-4">
                            <div class="text-center">
                              <div class="text-lg font-bold text-green-400">${lastAttempt.correct}</div>
                              <div class="text-xs text-gray-500">맞힌 개수</div>
                            </div>
                            <div class="text-center">
                              <div class="text-lg font-bold text-red-400">${lastAttempt.total - lastAttempt.correct}</div>
                              <div class="text-xs text-gray-500">틀린 개수</div>
                            </div>
                            <div class="text-center">
                              <div class="text-lg font-bold text-blue-400">${attempts.length}</div>
                              <div class="text-xs text-gray-500">시도 횟수</div>
                            </div>
                          </div>

                          ${allWrongQuestions.length > 0 ? `
                            <div class="bg-red-900/20 border border-red-500/30 rounded-xl p-4">
                              <h4 class="text-sm font-bold text-red-400 mb-3 flex items-center flex-wrap gap-2">
                                <span class="flex items-center">
                                  ${icon('xCircle', 'mr-2', 18)}복습 필요 문제
                                </span>
                                ${isRetakeAvailable ? `
                                  <span class="text-xs bg-orange-500/20 text-orange-400 px-2 py-1 rounded font-bold">
                                    재시험 전 복습!
                                  </span>
                                ` : ''}
                              </h4>
                              <div class="space-y-3">
                                ${allWrongQuestions.map((wrongQ, idx) => {
                                  const questionData = theme.questions.find(q => q.question === wrongQ);
                                  return `
                                    <div class="text-sm bg-gray-900/50 rounded-lg p-3 border border-red-500/20">
                                      <p class="text-red-300 font-medium mb-2 leading-relaxed">• ${wrongQ}</p>
                                      ${isRetakeAvailable ? `
                                        <p class="text-gray-400 text-xs leading-relaxed">
                                          <span class="text-orange-400 font-bold">💡 힌트:</span> ${questionData?.hint}
                                        </p>
                                      ` : `
                                        <p class="text-gray-400 text-xs leading-relaxed">
                                          <span class="text-green-400 font-bold">해설:</span> ${questionData?.explanation}
                                        </p>
                                      `}
                                    </div>
                                  `;
                                }).join('')}
                              </div>
                              ${isRetakeAvailable ? `
                                <div class="mt-4 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg text-center">
                                  <p class="text-blue-400 text-xs font-bold">
                                    ℹ️ 힌트 확인 후 재시험 도전! 재시험에서는 해설 제공
                                  </p>
                                </div>
                              ` : ''}
                            </div>
                          ` : ''}
                        </div>
                      `;
                    }).join('');
                  })()}
                </div>
              `}
            ` : currentStudentAttempts.length === 0 ? `
              <div class="bg-gray-900 rounded-2xl p-12 text-center border border-gray-800">
                ${icon('barChart', 'mx-auto mb-4 text-gray-600', 48)}
                <p class="text-gray-400 font-medium">아직 학습 기록이 없습니다.</p>
              </div>
            ` : `
              <div class="grid md:grid-cols-2 gap-4">
                ${categories.filter(cat => currentStudentAttempts.some(a => a.categoryId === cat.id)).map((cat) => {
                  const catAttempts = currentStudentAttempts.filter(a => a.categoryId === cat.id);
                  const avgPercentage = Math.round(catAttempts.reduce((sum, a) => sum + a.percentage, 0) / catAttempts.length);
                  
                  return `
                    <button data-cat="${cat.id}" class="cat-record-btn bg-gray-900 rounded-2xl p-6 border border-gray-800 shadow-xl hover:shadow-orange-500/20 hover:border-orange-500/50 transition-all text-left transform hover:scale-105 active:scale-95">
                      <h3 class="text-base font-bold text-white mb-2">${cat.name}</h3>
                      <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-500 font-semibold">평균 정답률</span>
                        <span class="text-lg font-bold text-orange-400">${avgPercentage}%</span>
                      </div>
                      <div class="text-xs text-gray-500 mt-2 font-medium">
                        시도 횟수: ${catAttempts.length}회
                      </div>
                    </button>
                  `;
                }).join('')}
              </div>
            `}
          </div>
        </div>
      `;

      document.getElementById('backBtn').addEventListener('click', () => {
        state.showResults = false;
        render();
      });

      if (state.selectedCategory) {
        const allRecordsBtn = document.getElementById('allRecordsBtn');
        if (allRecordsBtn) {
          allRecordsBtn.addEventListener('click', () => {
            state.selectedCategory = null;
            render();
          });
        }
      } else {
        document.querySelectorAll('.cat-record-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            state.selectedCategory = parseInt(btn.dataset.cat);
            render();
          });
        });
      }
    }

    // 온라인/오프라인 이벤트
    window.addEventListener('online', async () => {
      console.log('온라인 복구됨! 동기화 시작...');
      await syncPendingData();
    });

    window.addEventListener('offline', () => {
      console.log('오프라인 모드');
      alert('오프라인 상태입니다. 데이터는 로컬에 저장되며 온라인 복구 시 자동 동기화됩니다.');
    });

    // 타이머 시작
    setInterval(() => {
      state.currentTime = Date.now();
      
      document.querySelectorAll('[data-lock-timer]').forEach(element => {
        const themeId = parseInt(element.getAttribute('data-lock-timer'));
        if (isLocked(state.selectedCategory, themeId)) {
          const remainingSeconds = getRemainingTime(state.selectedCategory, themeId);
          const minutes = Math.floor(remainingSeconds / 60);
          const seconds = remainingSeconds % 60;
          element.textContent = `${minutes}:${seconds.toString().padStart(2, '0')} 후 재시험 가능`;
        } else {
          render();
        }
      });
    }, 1000);

    // 앱 초기화
    (async function initApp() {
      await initIndexedDB();
      
      if (checkAutoLogin()) {
        console.log('자동 로그인 실행');
        await handleStudentLogin(true);
      } else {
        render();
      }
      
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/service-worker.js')
          .then(registration => {
            console.log('Service Worker 등록 성공:', registration.scope);
          })
          .catch(error => {
            console.log('Service Worker 등록 실패:', error);
          });
      }
    })();
  </script>
</body>
</html>